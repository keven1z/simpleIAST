package com.keven1z.core.vulnerability.report;

import com.keven1z.core.error.http.ReportSendException;
import com.keven1z.core.log.ErrorType;
import com.keven1z.core.log.LogTool;
import com.keven1z.core.model.server.ReportData;
import com.keven1z.core.utils.http.HttpClientRegistry;
import com.keven1z.core.utils.http.ReportClient;
import org.apache.log4j.Logger;

public class ReportHandler {
    private static final Logger logger = Logger.getLogger(ReportHandler.class);

    public static void print(String reportString){
        System.out.println(reportString);
    }

    public static void send(String reportString) {
        try {
            boolean isSend = HttpClientRegistry.getInstance().getClient(ReportClient.class).sendVulnerabilityReport(reportString);
            if (isSend) {
                if (LogTool.isDebugEnabled()) {
                    logger.info("Send report success,body:" + reportString);
                }
            } else {
                logger.error("Send report failed,body:" + reportString);
            }
        } catch (ReportSendException e) {
            LogTool.error(ErrorType.REPORT_ERROR, "Send report failed", e);
        }
    }

    public static String buildReportLog(ReportData reportData){
        return String.format(
                "Found [%s] vulnerability - URL=%s | method=%s ",
                reportData.getFindingDataList().get(0).getVulnerableType(),
                reportData.getRequestData().getUrl(),
                reportData.getRequestData().getMethod()
        );
    }
}

import{Z as $,J as G,A as K,p as Q,M as W,E as X}from"./element-25094948.js";import{j as U,_ as ee}from"./index-7d92c181.js";import{d as te}from"./vxe-49b9e5de.js";import{p as ae,r as i,Z as oe,ai as r,aq as ne,q as k,t as le,P as L,M,O as t,v as d,U as e,u as y,S as p,T as w,aH as re,aI as se}from"./vue-8cd83afb.js";function ce(_){return U({url:"/log/list",method:"get",params:_})}function ie(){return U({url:"/log/export",method:"get",responseType:"blob"})}const pe=_=>(re("data-v-33b07fe6"),_=_(),se(),_),de={class:"app-container"},ue={class:"card-header"},me=pe(()=>d("span",{class:"ml-2 font-semibold"},"操作日志查询",-1)),_e={class:"toolbar-wrapper flex justify-between items-center mb-4"},fe={class:"text-primary font-medium"},ge={class:"flex gap-2"},he={class:"table-wrapper overflow-x-auto"},ve={class:"pager-wrapper flex justify-end mt-4"},be=ae({name:"OperationLog",__name:"operation-log",setup(_){const R=i([]),x=i(10),f=i(1),V=i(0),C=i(0),g=i(!1),z=i(),u={pageSize:10,pageNum:1},l=oe({operatorName:"",dateRange:[]}),Y=a=>a?te(a).format("YYYY-MM-DD HH:mm:ss"):"-",j=a=>{u.pageSize=a,x.value=a,h()},E=a=>{u.pageNum=a,f.value=a,h()},h=()=>{g.value=!0;const a={...u};l.operatorName&&(a.operatorName=l.operatorName),l.dateRange&&l.dateRange.length===2&&(a.startTime=l.dateRange[0],a.endTime=l.dateRange[1]),ce(a).then(n=>{const{pageSize:v,pageNum:s,total:m,pages:S,list:b}=(n==null?void 0:n.data)||{};R.value=b||[],x.value=v||10,V.value=S||0,f.value=s||1,C.value=m||0}).catch(n=>{console.error("获取操作日志失败:",n),R.value=[]}).finally(()=>{g.value=!1})},H=()=>{var a;(a=z.value)==null||a.resetFields(),Object.keys(u).forEach(n=>{n!=="pageSize"&&n!=="pageNum"&&delete u[n]}),u.pageNum=1,f.value=1,h()},O=()=>{u.pageNum=1,f.value=1,h()},P=()=>{g.value=!0,l.operatorName&&l.operatorName,l.dateRange&&l.dateRange.length===2&&(l.dateRange[0],l.dateRange[1]),ie().then(a=>{const n=new Blob([a]),v=window.URL.createObjectURL(n),s=document.createElement("a");s.href=v;const m=`操作日志_${Date.now()}.xlsx`;s.download=m,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(v)}).catch(a=>{console.error("导出操作日志失败:",a),X.error("导出操作日志失败，请稍后重试")}).finally(()=>{g.value=!1})},B=i([]);function q(a){B.value=a}return h(),(a,n)=>{const v=r("el-icon"),s=r("el-input"),m=r("el-form-item"),S=r("el-date-picker"),b=r("el-button"),F=r("el-form"),T=r("el-card"),c=r("el-table-column"),A=r("el-tag"),D=r("el-text"),N=r("el-tooltip"),Z=r("el-table"),J=r("el-pagination"),I=ne("loading");return k(),le("div",de,[L((k(),M(T,{shadow:"never",class:"search-wrapper mb-4"},{default:t(()=>[d("div",ue,[e(v,{size:"18"},{default:t(()=>[e(y($))]),_:1}),me]),e(F,{ref_key:"searchFormRef",ref:z,inline:!0,model:l,class:"mt-3"},{default:t(()=>[e(m,{prop:"operatorName",label:"操作者账号"},{default:t(()=>[e(s,{modelValue:l.operatorName,"onUpdate:modelValue":n[0]||(n[0]=o=>l.operatorName=o),placeholder:"请输入操作者账号",clearable:""},null,8,["modelValue"])]),_:1}),e(m,{prop:"dateRange",label:"操作时间"},{default:t(()=>[e(S,{modelValue:l.dateRange,"onUpdate:modelValue":n[1]||(n[1]=o=>l.dateRange=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD HH:mm:ss",format:"YYYY-MM-DD HH:mm:ss",clearable:""},null,8,["modelValue"])]),_:1}),e(m,null,{default:t(()=>[e(b,{type:"primary",icon:y(G),onClick:O},{default:t(()=>[p("查询")]),_:1},8,["icon"]),e(b,{icon:y(K),onClick:H},{default:t(()=>[p("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1})),[[I,g.value]]),L((k(),M(T,{shadow:"never"},{default:t(()=>[d("div",_e,[d("div",fe,"共 "+w(C.value)+" 条操作记录",1),d("div",ge,[e(b,{type:"success",icon:y(Q),onClick:P},{default:t(()=>[p(" 导出数据 ")]),_:1},8,["icon"]),e(b,{type:"primary",icon:y(W),onClick:h},{default:t(()=>[p(" 刷新 ")]),_:1},8,["icon"])])]),d("div",he,[e(Z,{data:R.value,onSelectionChange:q,stripe:"",style:{width:"100%"},"empty-text":"暂无数据"},{default:t(()=>[e(c,{type:"selection",width:"55"}),e(c,{prop:"id",label:"日志ID",width:"80",align:"center"}),e(c,{prop:"operationType",label:"操作类型",width:"180",align:"center"},{default:t(o=>[e(A,{type:"info",size:"small"},{default:t(()=>[p(w(o.row.operationType||"未知"),1)]),_:2},1024)]),_:1}),e(c,{prop:"operatorName",label:"操作者",width:"120",align:"center"}),e(c,{prop:"content",label:"操作内容",align:"left"},{default:t(o=>[e(N,{content:o.row.content||"无",placement:"top"},{default:t(()=>[e(D,{maxlength:80,"show-overflow-tooltip":""},{default:t(()=>[p(w(o.row.content||"无"),1)]),_:2},1024)]),_:2},1032,["content"])]),_:1}),e(c,{prop:"operationParam",label:"操作参数",align:"left",width:"200"},{default:t(o=>[e(N,{content:o.row.operationParam||"无",placement:"top"},{default:t(()=>[e(D,{truncated:""},{default:t(()=>[p(w(o.row.operationParam||"无"),1)]),_:2},1024)]),_:2},1032,["content"])]),_:1}),e(c,{prop:"ipAddress",label:"IP地址",width:"140",align:"center"}),e(c,{prop:"deviceInfo",label:"设备信息",align:"left","min-width":"200"},{default:t(o=>[e(N,{content:o.row.deviceInfo||"无",placement:"top"},{default:t(()=>[e(D,{truncated:""},{default:t(()=>[p(w(o.row.deviceInfo||"无"),1)]),_:2},1024)]),_:2},1032,["content"])]),_:1}),e(c,{prop:"operationTime",label:"操作时间",width:"180",align:"center",sortable:""},{default:t(o=>[e(N,{content:Y(o.row.operationTime),placement:"top"},{default:t(()=>[d("span",null,w(Y(o.row.operationTime)),1)]),_:2},1032,["content"])]),_:1})]),_:1},8,["data"])]),d("div",ve,[e(J,{background:"","current-page":f.value,"onUpdate:currentPage":n[2]||(n[2]=o=>f.value=o),"page-size":x.value,"onUpdate:pageSize":n[3]||(n[3]=o=>x.value=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:C.value,onSizeChange:j,onCurrentChange:E,small:""},null,8,["current-page","page-size","total"])])]),_:1})),[[I,g.value]])])}}});const Re=ee(be,[["__scopeId","data-v-33b07fe6"]]);export{Re as default};

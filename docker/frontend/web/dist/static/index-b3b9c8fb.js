import{J as H,A as Q,L as W,M as X,t as Y,O as Z,P as ee,E as _,N as te}from"./element-25094948.js";import{a as P,u as ae}from"./index-b8d5ef49.js";import{g as le}from"./state-8799bcff.js";import{k as oe,_ as ne}from"./index-7d92c181.js";import{p as se,r as w,ai as s,aq as ie,q as m,t as re,P as B,M as b,O as a,v as i,U as e,u as p,S as f,T as g}from"./vue-8cd83afb.js";/* empty css                                                       */import"./vxe-49b9e5de.js";const ce={class:"app-container"},de={class:"toolbar-wrapper"},ue={class:"table-wrapper"},pe=["onClick"],_e={class:"hostname-display"},me={class:"path-display",style:{"word-break":"break-all",overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical"}},fe={class:"version-display"},ge={class:"jdk-display"},ve={class:"state-display"},he={class:"ml-1"},we={class:"demo-pagination-block"},be=se({__name:"index",setup(ye){const d=w(!1),D=w(!1),C=w([]),l=w({pageSize:10,pageNum:1,hostname:"",state:""}),u=async()=>{d.value=!0;try{const o=await P.getAgentsByPage(l.value),{pageSize:n=10,pageNum:r=1,total:v=0,pages:h=0,list:S=[]}=o.data||{};C.value=S,l.value.pageSize=n,l.value.totalPages=h,l.value.pageNum=r,l.value.totalItems=v}catch(o){console.error("获取Agent列表失败:",o),C.value=[],_.warning("获取Agent列表失败，请稍后重试")}finally{d.value=!1}};u();const V=w();async function T(o,n){try{const r=await ae(o,n);(r==null?void 0:r.code)===0?(_.success("更新成功"),u()):_.warning("更新失败")}catch(r){console.error("更新检测状态失败:",r),_.error("更新失败，请稍后重试")}}function R(){const o=[];for(const n of V.value)o.push(n.agentId);te.confirm("确定删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{_({type:"success",message:"删除成功"}),d.value=!0,Promise.all(o.map(n=>P.deleteAgent(n))).then(()=>{u()}).finally(()=>{d.value=!1})}).catch(()=>{_({type:"info",message:"删除取消"})})}const U=o=>{V.value=o},j=o=>{l.value.pageSize=o,u()},E=o=>{l.value.pageNum=o,u()},M=o=>{};async function $(){const o=l.value.hostname;if(l.value.state==="-1"&&o===""){u();return}d.value=!0;try{u()}catch{_.warning("搜索失败，请稍后重试")}finally{d.value=!1}}const q=()=>{l.value.hostname="",l.value.state="",l.value.pageNum=1,l.value.pageSize=10},J=({row:o})=>o.state===0?"row-disabled":"",L=o=>{oe.push(`/app-detail/${o}`)};return(o,n)=>{const r=s("el-input"),v=s("el-form-item"),h=s("el-option"),S=s("el-select"),y=s("el-button"),O=s("el-form"),N=s("el-card"),A=s("el-tooltip"),c=s("el-table-column"),k=s("el-tag"),z=s("el-icon"),F=s("el-switch"),K=s("el-table"),G=s("el-pagination"),I=ie("loading");return m(),re("div",ce,[B((m(),b(N,{class:"search-wrapper"},{default:a(()=>[i("div",null,[e(O,{ref:"searchFormRef",inline:!0,model:l.value},{default:a(()=>[e(v,{prop:"hostname",label:"服务器名称"},{default:a(()=>[e(r,{modelValue:l.value.hostname,"onUpdate:modelValue":n[0]||(n[0]=t=>l.value.hostname=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(v,{prop:"state",label:"状态"},{default:a(()=>[e(S,{modelValue:l.value.state,"onUpdate:modelValue":n[1]||(n[1]=t=>l.value.state=t),style:{width:"100px"}},{default:a(()=>[e(h,{label:"所有",value:""}),e(h,{label:"在线",value:"1"}),e(h,{label:"离线",value:"0"})]),_:1},8,["modelValue"])]),_:1}),e(v,null,{default:a(()=>[e(y,{type:"primary",icon:p(H),onClick:n[2]||(n[2]=t=>$())},{default:a(()=>[f("查询")]),_:1},8,["icon"]),e(y,{icon:p(Q),onClick:q},{default:a(()=>[f("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])])]),_:1})),[[I,d.value]]),B((m(),b(N,null,{default:a(()=>[i("div",de,[i("div",null,[e(y,{type:"danger",icon:p(W),onClick:R},{default:a(()=>[f("批量删除")]),_:1},8,["icon"])]),i("div",null,[e(A,{content:"刷新当前页"},{default:a(()=>[e(y,{type:"primary",icon:p(X),circle:"",onClick:u},null,8,["icon"])]),_:1})])]),i("div",ue,[e(K,{ref:"multipleTableRef",data:C.value,border:"",style:{width:"100%"},"default-sort":{prop:"timestamp",order:"descending"},onSelectionChange:U,onRowClick:M,"row-class-name":J},{default:a(()=>[e(c,{type:"selection",width:"55"}),e(c,{label:"ID",prop:"agentId",width:"320"},{default:a(t=>[i("div",{class:"agent-id-display",style:{cursor:"pointer",color:"#409eff"},onClick:x=>L(t.row.agentId)},g(t.row.agentId),9,pe)]),_:1}),e(c,{width:"240",prop:"hostname",label:"服务器名称",sortable:""},{default:a(t=>[i("div",_e,[e(k,{size:"default",type:"info",effect:"light"},{default:a(()=>[f(g(t.row.hostname),1)]),_:2},1024)])]),_:1}),e(c,{label:"应用路径",prop:"serverPath","min-width":"280"},{default:a(t=>[e(A,{content:t.row.serverPath,placement:"top",effect:"dark"},{default:a(()=>[i("div",me,g(t.row.serverPath),1)]),_:2},1032,["content"])]),_:1}),e(c,{label:"Agent版本",prop:"version",width:"120"},{default:a(t=>[i("div",fe,[e(k,{size:"small",type:"primary",effect:"light"},{default:a(()=>[f(g(t.row.version||"-"),1)]),_:2},1024)])]),_:1}),e(c,{label:"JDK",prop:"jdkVersion",width:"100"},{default:a(t=>[i("div",ge,[e(k,{size:"small",type:"success",effect:"light"},{default:a(()=>[f(g(t.row.jdkVersion||"-"),1)]),_:2},1024)])]),_:1}),e(c,{prop:"state",width:"120",label:"运行状态",align:"center",sortable:""},{default:a(t=>[i("div",ve,[e(k,{size:"small",effect:"light",type:t.row.state===1?"success":t.row.state===0?"danger":"warning"},{default:a(()=>[t.row.state===1?(m(),b(z,{key:0},{default:a(()=>[e(p(Y))]),_:1})):t.row.state===0?(m(),b(z,{key:1},{default:a(()=>[e(p(Z))]),_:1})):(m(),b(z,{key:2},{default:a(()=>[e(p(ee))]),_:1})),i("span",he,g(p(le)(t.row.state)),1)]),_:2},1032,["type"])])]),_:1}),e(c,{prop:"state",width:"120",label:"检测状态",align:"center",sortable:""},{default:a(t=>[e(F,{modelValue:t.row.detectionStatus,"onUpdate:modelValue":x=>t.row.detectionStatus=x,"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949",onClick:x=>T(t.row.agentId,t.row.detectionStatus)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),e(c,{prop:"lastActiveTime",width:"200",label:"最近活跃时间",sortable:""})]),_:1},8,["data"])]),i("div",we,[e(G,{"current-page":l.value.pageNum,"onUpdate:currentPage":n[3]||(n[3]=t=>l.value.pageNum=t),"page-size":l.value.pageSize,"onUpdate:pageSize":n[4]||(n[4]=t=>l.value.pageSize=t),"page-sizes":[10,20,50,100],small:!1,disabled:D.value,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:l.value.totalItems,onSizeChange:j,onCurrentChange:E},null,8,["current-page","page-size","disabled","total"])])]),_:1})),[[I,d.value]])])}}});const Ae=ne(be,[["__scopeId","data-v-6b4464a0"]]);export{Ae as default};

import{K as le,B as oe,L as ne,M as ie,N as se,q as re,E as _,O as ue}from"./element-4f7446fd.js";import{j as C,_ as de}from"./index-db029066.js";import{p as ce,r as f,Z as M,ai as r,aq as pe,q as N,t as me,U as e,O as a,v as n,S as s,u as x,P as _e,M as fe,T as D,aH as ve,aI as ge}from"./vue-8cd83afb.js";import"./vxe-d278ed3b.js";function he(u,c,k){return C({url:"/apikey/create",method:"post",params:{name:u,description:c,expiredDate:k}})}function ye(u){return C({url:`/apikey/delete/${u}`,method:"delete"})}function we(u,c){return C({url:"/apikey/list",method:"get",params:{pageNum:u,pageSize:c}})}function be(u,c){return C({url:"/apikey/updateStatus",method:"get",params:{id:u,status:c}})}function xe(u,c=1,k=10){return C({url:"/apikey/search",method:"get",params:{name:u,pageNum:c,pageSize:k}})}const U=u=>(ve("data-v-2204ee48"),u=u(),ge(),u),ke={class:"setting-container"},Ae=U(()=>n("div",{class:"tip custom-block"},[n("p",{class:"custom-block-title"},"说明"),n("p",null,"API密钥用于授权第三方应用访问系统API。"),n("p",null,"您可以设置过期时间，过期后密钥将自动失效。")],-1)),Ve={class:"dialog-footer"},Ie={class:"toolbar-wrapper"},Ce={class:"table-wrapper"},Pe={class:"flex items-center"},De={class:"demo-pagination-block"},Ue=U(()=>n("div",{class:"card-header"},[n("span",null,"API密钥使用说明")],-1)),Te={class:"usage-content"},Se=U(()=>n("p",null,"使用以下命令调用API时，在请求头中包含API密钥：",-1)),qe=U(()=>n("p",{class:"note"},[s(" 请将 "),n("code",null,"your-api-key-value"),s(" 替换为您的实际API密钥值，"),n("code",null,"some-endpoint"),s(" 替换为您需要访问的具体接口路径。 ")],-1)),z="100px",ze=ce({__name:"apikey",setup(u){const c=f([]),k=f(),p=f(!1),$=f(!1),A=f([]),w=f(10),V=f(1),B=f(0),T=f(0),b=M({name:""}),I=f(!1),d=M({name:"",description:"",expireOption:"0"});function E(){d.name="",d.description="",d.expireOption="1",I.value=!0}function R(){I.value=!1}const j=o=>{c.value=o},v=()=>{p.value=!0,(b.name?xe(b.name,V.value,w.value):we(V.value,w.value)).then(t=>{const i=t.data;A.value=i.list||[],T.value=i.total||0,B.value=Math.ceil((i.total||0)/w.value)}).catch(()=>{A.value=[],T.value=0,B.value=0}).finally(()=>{p.value=!1})};function F(){I.value=!1,p.value=!0;let o;if(d.expireOption!=="0"){const t=parseInt(d.expireOption),i=new Date;i.setDate(i.getDate()+t),o=i}he(d.name,d.description,o).then(()=>{_.success("创建API密钥成功")}).catch(()=>{_.error("创建API密钥失败")}).finally(()=>{p.value=!1,v()})}function H(){if(c.value.length===0){_.warning("请选择要删除的API密钥");return}const o=[];for(const t of c.value)o.push(t.id);ue.confirm(`确定删除选中的${o.length}个API密钥？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{p.value=!0;const t=o.map(i=>ye(i));Promise.all(t).then(()=>{_.success("删除成功")}).catch(()=>{_.error("删除失败")}).finally(()=>{p.value=!1,v()})}).catch(()=>{_.info("取消删除")})}function W(o){if(!o||o.length<=8)return o;const t=o.substring(0,4),i=o.substring(o.length-4),m=Math.max(4,o.length-8),h="*".repeat(m);return`${t}${h}${i}`}function Z(o){navigator.clipboard.writeText(o).then(()=>{_.success("API密钥已复制到剪贴板")}).catch(()=>{_.error("复制失败")})}function O(o){if(!o)return"永久有效";try{return new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return o}}async function G(o,t){try{p.value=!0,await be(o,t),_.success(t===1?"已启用密钥":"已禁用密钥"),v()}catch{_.error("状态更新失败");const m=A.value.findIndex(h=>h.id===o);m!==-1&&(A.value[m].status=t===1?0:1)}finally{p.value=!1}}return v(),(o,t)=>{const i=r("el-input"),m=r("el-form-item"),h=r("el-radio"),J=r("el-radio-group"),K=r("el-form"),g=r("el-button"),Q=r("el-dialog"),S=r("el-card"),q=r("el-tooltip"),y=r("el-table-column"),L=r("el-text"),X=r("el-switch"),Y=r("el-table"),ee=r("el-pagination"),te=r("el-divider"),ae=pe("loading");return N(),me("div",ke,[Ae,e(Q,{modelValue:I.value,"onUpdate:modelValue":t[3]||(t[3]=l=>I.value=l),title:"创建API密钥"},{footer:a(()=>[n("div",Ve,[e(g,{onClick:R},{default:a(()=>[s("取消")]),_:1}),e(g,{type:"primary",onClick:F,loading:p.value},{default:a(()=>[s(" 确认 ")]),_:1},8,["loading"])])]),default:a(()=>[e(K,null,{default:a(()=>[e(m,{label:"密钥名称","label-width":z,required:""},{default:a(()=>[e(i,{autocomplete:"off",modelValue:d.name,"onUpdate:modelValue":t[0]||(t[0]=l=>d.name=l),placeholder:"请输入密钥名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"密钥描述","label-width":z},{default:a(()=>[e(i,{autocomplete:"off",modelValue:d.description,"onUpdate:modelValue":t[1]||(t[1]=l=>d.description=l),placeholder:"请输入密钥描述",type:"textarea"},null,8,["modelValue"])]),_:1}),e(m,{label:"过期时间","label-width":z,required:""},{default:a(()=>[e(J,{modelValue:d.expireOption,"onUpdate:modelValue":t[2]||(t[2]=l=>d.expireOption=l)},{default:a(()=>[e(h,{value:"1"},{default:a(()=>[s("1天")]),_:1}),e(h,{value:"7"},{default:a(()=>[s("7天")]),_:1}),e(h,{value:"0"},{default:a(()=>[s("永久")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(S,{shadow:"never",class:"search-wrapper"},{default:a(()=>[n("div",null,[e(K,{inline:!0,model:b},{default:a(()=>[e(m,{prop:"name",label:"密钥名称"},{default:a(()=>[e(i,{placeholder:"请输入",modelValue:b.name,"onUpdate:modelValue":t[4]||(t[4]=l=>b.name=l)},null,8,["modelValue"])]),_:1}),e(m,null,{default:a(()=>[e(g,{type:"primary",icon:x(le),onClick:v},{default:a(()=>[s("查询")]),_:1},8,["icon"]),e(g,{icon:x(oe),onClick:t[5]||(t[5]=()=>{b.name="",v()})},{default:a(()=>[s("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])])]),_:1}),e(S,{shadow:"never"},{default:a(()=>[n("div",Ie,[n("div",null,[e(g,{type:"primary",icon:x(ne),onClick:E},{default:a(()=>[s("创建API密钥")]),_:1},8,["icon"]),e(g,{type:"danger",icon:x(ie),onClick:H},{default:a(()=>[s("批量删除")]),_:1},8,["icon"])]),n("div",null,[e(q,{content:"刷新当前页"},{default:a(()=>[e(g,{type:"primary",icon:x(se),circle:"",onClick:v},null,8,["icon"])]),_:1})])]),n("div",Ce,[_e((N(),fe(Y,{ref_key:"multipleTableRef",ref:k,data:A.value,style:{width:"100%"},onSelectionChange:j},{default:a(()=>[e(y,{type:"selection",width:"55"}),e(y,{prop:"name",label:"密钥名称",align:"left"}),e(y,{prop:"description",label:"密钥描述",align:"left"},{default:a(l=>[e(q,{content:l.row.description||"无描述",placement:"top"},{default:a(()=>[e(L,{maxlength:50,"show-overflow-tooltip":""},{default:a(()=>[s(D(l.row.description||"无描述"),1)]),_:2},1024)]),_:2},1032,["content"])]),_:1}),e(y,{prop:"apiKey",label:"API密钥",align:"left",width:"300"},{default:a(l=>[n("div",Pe,[e(q,{content:"点击复制",placement:"top"},{default:a(()=>[e(g,{type:"text",icon:x(re),onClick:P=>Z(l.row.apiKey),class:"mr-2"},null,8,["icon","onClick"])]),_:2},1024),e(L,{maxlength:30,"show-overflow-tooltip":""},{default:a(()=>[s(D(W(l.row.apiKey)),1)]),_:2},1024)])]),_:1}),e(y,{label:"创建时间",align:"left",width:"180"},{default:a(l=>[s(D(O(l.row.createdTime)),1)]),_:1}),e(y,{label:"过期时间",align:"left",width:"180"},{default:a(l=>[s(D(O(l.row.expiredTime)),1)]),_:1}),e(y,{label:"状态",align:"left",width:"140"},{default:a(l=>[e(X,{modelValue:l.row.status,"onUpdate:modelValue":P=>l.row.status=P,"active-value":1,"inactive-value":0,onChange:P=>G(l.row.id,Number(P))},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1},8,["data"])),[[ae,p.value]])]),n("div",De,[e(ee,{"current-page":V.value,"onUpdate:currentPage":t[6]||(t[6]=l=>V.value=l),"page-size":w.value,"onUpdate:pageSize":t[7]||(t[7]=l=>w.value=l),"page-sizes":[10,20,50,100],small:!1,disabled:$.value,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:T.value,onSizeChange:t[8]||(t[8]=l=>{w.value=l,v()}),onCurrentChange:t[9]||(t[9]=l=>{V.value=l,v()})},null,8,["current-page","page-size","disabled","total"])])]),_:1}),e(S,{shadow:"hover",class:"usage-instruction-card"},{header:a(()=>[Ue]),default:a(()=>[n("div",Te,[Se,e(te),e(i,{type:"textarea",rows:1,readonly:"",value:"curl -H 'API-Key: your-api-key-value' http://localhost:8443/api/v1/some-endpoint"}),qe])]),_:1})])}}});const Me=de(ze,[["__scopeId","data-v-2204ee48"]]);export{Me as default};

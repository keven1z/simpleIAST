import{u as J,K as Q,B as X,L as Y,M as $,N as ee,E as p,O as ae}from"./element-4f7446fd.js";import{j as B,_ as le}from"./index-87a91d15.js";import{p as te,r as u,Z as z,ai as s,q as oe,t as ne,U as e,O as a,v as o,S as m,u as _,aH as se,aI as ie}from"./vue-8cd83afb.js";import"./vxe-d278ed3b.js";function ce(i){return B({url:"blacklist/list/page",method:"get",params:i})}function re(i){return B({url:"blacklist/add",method:"post",data:i})}function ue(i){return B({url:"blacklist/delete",method:"delete",params:{name:i}})}const F=i=>(se("data-v-d2b3edf8"),i=i(),ie(),i),de={class:"setting-container"},pe=F(()=>o("div",{class:"tip custom-block"},[o("p",{class:"custom-block-title"},"说明"),o("p",null,"设置agent绑定的主机名黑名单，黑名单主机名将禁止向服务端注册，也不会进行漏洞探测操作。"),o("p",null,"黑名单主机名支持模糊匹配")],-1)),me={class:"form-tip"},_e=F(()=>o("span",null,"支持模糊匹配，添加后主机名将被禁止向服务端注册",-1)),fe={class:"dialog-footer"},ge={class:"toolbar-wrapper"},he={class:"table-wrapper"},ve={class:"demo-pagination-block"},be="120px",ke=te({__name:"blacklist",setup(i){const v=u([]),b=u(!1),R=u(!1),C=u([]),N=u(0),n=z({pageSize:10,pageNum:1,name:""}),f=z({name:""}),w=u(),S=u(!1),U={name:[{required:!0,message:"请输入主机名称",trigger:"blur"},{min:1,max:100,message:"主机名称长度应在1-100个字符之间",trigger:"blur"}]};function q(){var l;(l=w.value)==null||l.validate(t=>{t&&(S.value=!0,g.value=!1,re(f).then(()=>{p.success("添加黑名单成功"),x()}).catch(()=>{p.error("添加黑名单失败，请重试")}).finally(()=>{S.value=!1,r()}))})}function x(){var l;f.name="",(l=w.value)==null||l.resetFields()}const g=u(!1);function I(){x(),g.value=!0}function T(){g.value=!1,x()}const E=l=>{v.value=l},r=()=>{b.value=!0,ce(n).then(l=>{const{total:t,list:k}=l.data||{};C.value=k||[],N.value=t||0}).catch(()=>{C.value=[]}).finally(()=>{b.value=!1})};function j(){if(!v.value||v.value.length===0){p.warning("请选择要删除的黑名单");return}const l=[];for(const t of v.value)l.push(t.name);ae.confirm("确定删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{b.value=!0,ue(l.join(",")).then(()=>{p({type:"success",message:"删除成功"}),r()}).catch(()=>{p({type:"error",message:"删除失败"})}).finally(()=>{b.value=!1})}).catch(()=>{p({type:"info",message:"已取消删除"})})}r();const M=l=>{n.pageSize=l,r()},O=l=>{n.pageNum=l,r()};function H(){n.name=h.name,n.pageNum=1,r()}const h=z({name:""}),K=()=>{h.name="",n.name="",n.pageNum=1,r()};return(l,t)=>{const k=s("el-input"),y=s("el-form-item"),P=s("el-icon"),L=s("el-form"),d=s("el-button"),W=s("el-dialog"),D=s("el-card"),Z=s("el-tooltip"),V=s("el-table-column"),A=s("el-table"),G=s("el-pagination");return oe(),ne("div",de,[pe,e(W,{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=c=>g.value=c),title:"添加黑名单",width:"400px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[o("div",fe,[e(d,{onClick:T},{default:a(()=>[m("取消")]),_:1}),e(d,{type:"primary",onClick:q,loading:S.value},{default:a(()=>[m(" 确认添加 ")]),_:1},8,["loading"])])]),default:a(()=>[e(L,{ref_key:"blacklistFormRef",ref:w,model:f,rules:U,"label-width":be,class:"blacklist-form"},{default:a(()=>[e(y,{label:"主机名称",prop:"name"},{default:a(()=>[e(k,{autocomplete:"off",modelValue:f.name,"onUpdate:modelValue":t[0]||(t[0]=c=>f.name=c),placeholder:"请输入主机名称",clearable:""},null,8,["modelValue"])]),_:1}),e(y,{"label-width":"0"},{default:a(()=>[o("div",me,[e(P,null,{default:a(()=>[e(_(J))]),_:1}),_e])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(D,{shadow:"never",class:"search-wrapper"},{default:a(()=>[o("div",null,[e(L,{ref:"searchFormRef",inline:!0,model:h},{default:a(()=>[e(y,{prop:"hostName",label:"主机名称"},{default:a(()=>[e(k,{placeholder:"请输入",modelValue:h.name,"onUpdate:modelValue":t[2]||(t[2]=c=>h.name=c)},null,8,["modelValue"])]),_:1}),e(y,null,{default:a(()=>[e(d,{type:"primary",icon:_(Q),onClick:H},{default:a(()=>[m("查询")]),_:1},8,["icon"]),e(d,{icon:_(X),onClick:K},{default:a(()=>[m("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])])]),_:1}),e(D,{shadow:"never"},{default:a(()=>[o("div",ge,[o("div",null,[e(d,{type:"primary",icon:_(Y),onClick:I},{default:a(()=>[m("新增黑名单")]),_:1},8,["icon"]),e(d,{type:"danger",icon:_($),onClick:j},{default:a(()=>[m("批量删除")]),_:1},8,["icon"])]),o("div",null,[e(Z,{content:"刷新当前页"},{default:a(()=>[e(d,{type:"primary",icon:_(ee),circle:"",onClick:r},null,8,["icon"])]),_:1})])]),o("div",he,[e(A,{ref:"multipleTableRef",data:C.value,style:{width:"100%"},onSelectionChange:E},{default:a(()=>[e(V,{type:"selection",width:"55"}),e(V,{prop:"id",label:"id",align:"left"}),e(V,{prop:"name",label:"主机名称",align:"left",sortable:""})]),_:1},8,["data"])]),o("div",ve,[e(G,{"current-page":n.pageNum,"onUpdate:currentPage":t[3]||(t[3]=c=>n.pageNum=c),"page-size":n.pageSize,"onUpdate:pageSize":t[4]||(t[4]=c=>n.pageSize=c),"page-sizes":[10,20,50,100],small:!1,disabled:R.value,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:N.value,onSizeChange:M,onCurrentChange:O},null,8,["current-page","page-size","disabled","total"])])]),_:1})])}}});const xe=le(ke,[["__scopeId","data-v-d2b3edf8"]]);export{xe as default};

import{p as _e,r as v,Z as pe,f as P,ai as n,aq as fe,q as d,t as J,v as o,U as a,u as V,S as c,M as h,R as I,O as s,a9 as he,P as ge,T as _,Q as O,a2 as Q,I as me,aH as ve,aI as we}from"./vue-8cd83afb.js";import{j as Z,J as ye,M as be,_ as Ce,k as ke,l as xe,w as ze,E as g}from"./element-25094948.js";import{_ as Ne}from"./index-7d92c181.js";import{c as Re,r as F}from"./index-05f128ae.js";import"./vxe-49b9e5de.js";const G=N=>(ve("data-v-1cb7e28b"),N=N(),we(),N),Se={class:"app-container"},Ve={class:"notice-header"},De={class:"page-title"},Te={class:"toolbar-wrapper"},Ie={class:"left-tools"},Le={class:"right-tools"},Me={class:"table-wrapper"},Ue={class:"notice-title"},qe={class:"title-text"},Ae={class:"notice-time"},Be={class:"pager-wrapper"},He={class:"notice-detail-content"},$e={class:"detail-header"},je={class:"header-left"},Ee={class:"detail-time"},Ke={class:"detail-body"},Pe={class:"detail-description-wrapper"},Je=G(()=>o("h3",{class:"detail-subtitle"},"内容详情：",-1)),Oe={class:"detail-description"},Qe={key:0,class:"detail-extra"},Ze=G(()=>o("div",{class:"extra-header"},[o("h4",null,"详细数据：")],-1)),Fe={class:"detail-json"},Ge={class:"dialog-footer"},We=_e({name:"NoticeHistory",__name:"notice-history",setup(N){const W=()=>{i.value&&(D(i.value.id),y.value=!1)},R=v([]),S=v(!1),p={pageSize:20,pageNum:1},L=v(0),w=v([]),i=v(null),y=v(!1),u=pe({status:"",searchText:""}),M=P(()=>R.value.filter(e=>e.isRead===0).length),U=e=>{switch(e){case"warning":return ze;case"success":return xe;case"info":return ke;default:return Z}},X=e=>{switch(e){case"warning":return"notice-warning";case"success":return"notice-success";case"info":return"notice-info";default:return"notice-default"}},f=()=>{S.value=!0,Re(p).then(e=>{const{pageSize:l,pageNum:b,total:r,pages:C,list:k}=e.data;R.value=k,L.value=r}).catch(()=>{R.value=[],g.error("获取通知列表失败")}).finally(()=>{S.value=!1})};f();const D=e=>{F(e).then(()=>{g.success("已标记为已读"),f()}).catch(()=>{g.error("标记失败")})},Y=()=>{if(w.value.length===0){g.warning("请选择要标记的通知");return}const e=w.value.filter(l=>l.isRead===0);if(e.length===0){g.warning("所选通知已全部为已读状态");return}Promise.all(e.map(l=>F(l.id))).then(()=>{g.success(`成功标记 ${e.length} 条通知为已读`),f(),w.value=[]}).catch(()=>{g.error("批量标记失败")})},ee=e=>{w.value=e},te=e=>{p.pageSize=e,f()},ae=e=>{p.pageNum=e,f()},q=e=>{i.value=e,y.value=!0,e.isRead===0&&D(e.id)},A=()=>{f()},B=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"",le=P(()=>{let e=[...R.value];if(u.status==="unread"?e=e.filter(l=>l.isRead===0):u.status==="read"&&(e=e.filter(l=>l.isRead===1)),u.searchText){const l=u.searchText.toLowerCase();e=e.filter(b=>{var r,C;return((r=b.title)==null?void 0:r.toLowerCase().includes(l))||((C=b.description)==null?void 0:C.toLowerCase().includes(l))})}return e});return(e,l)=>{var $;const b=n("el-badge"),r=n("el-button"),C=n("el-input"),k=n("el-radio-button"),se=n("el-radio-group"),oe=n("el-tooltip"),m=n("el-table-column"),H=n("el-tag"),T=n("el-icon"),ne=n("el-text"),ie=n("el-table"),ce=n("el-pagination"),re=n("el-card"),de=n("el-dialog"),ue=fe("loading");return d(),J("div",Se,[o("div",Ve,[o("h2",De,[a(V(Z),{class:"title-icon"}),c(" 通知历史 "),M.value>0?(d(),h(b,{key:0,value:M.value,class:"unread-badge"},null,8,["value"])):I("",!0)])]),a(re,{shadow:"hover",class:"notice-card"},{default:s(()=>[o("div",Te,[o("div",Ie,[a(r,{type:"primary",plain:"",onClick:Y,disabled:w.value.length===0},{default:s(()=>[c(" 批量标记已读 ")]),_:1},8,["disabled"])]),o("div",Le,[a(C,{modelValue:u.searchText,"onUpdate:modelValue":l[0]||(l[0]=t=>u.searchText=t),placeholder:"搜索通知标题或描述","prefix-icon":V(ye),class:"search-input",clearable:"",onKeyup:he(A,["enter"])},null,8,["modelValue","prefix-icon","onKeyup"]),a(se,{modelValue:u.status,"onUpdate:modelValue":l[1]||(l[1]=t=>u.status=t),class:"status-filter",onChange:A},{default:s(()=>[a(k,{label:"",border:""},{default:s(()=>[c("全部")]),_:1}),a(k,{label:"unread",border:""},{default:s(()=>[c("未读")]),_:1}),a(k,{label:"read",border:""},{default:s(()=>[c("已读")]),_:1})]),_:1},8,["modelValue"]),a(oe,{content:"刷新当前页"},{default:s(()=>[a(r,{type:"primary",icon:V(be),circle:"",onClick:f,loading:S.value},null,8,["icon","loading"])]),_:1})])]),o("div",Me,[ge((d(),h(ie,{data:le.value,onSelectionChange:ee,style:{width:"100%"},onRowClick:q},{default:s(()=>[a(m,{type:"selection",width:"55"}),a(m,{label:"状态",width:"80",align:"center"},{default:s(t=>[a(H,{type:t.row.isRead===0?"danger":"success",size:"small",effect:"plain"},{default:s(()=>[c(_(t.row.isRead===0?"未读":"已读"),1)]),_:2},1032,["type"])]),_:1}),a(m,{prop:"title",label:"通知标题","min-width":"200","show-overflow-tooltip":""},{default:s(t=>[o("div",Ue,[a(T,{class:"notice-icon"},{default:s(()=>[(d(),h(O(U(t.row.type||"default"))))]),_:2},1024),o("span",qe,_(t.row.title),1)])]),_:1}),a(m,{prop:"description",label:"描述","min-width":"300","show-overflow-tooltip":""},{default:s(t=>[a(ne,null,{default:s(()=>[c(_(t.row.description),1)]),_:2},1024)]),_:1}),a(m,{prop:"datetime",label:"时间",width:"180",align:"center"},{default:s(t=>[o("div",Ae,[o("span",null,_(B(t.row.datetime)),1)])]),_:1}),a(m,{label:"操作",width:"150",align:"center",fixed:"right"},{default:s(t=>[t.row.isRead===0?(d(),h(r,{key:0,type:"primary",size:"small",onClick:Q(x=>D(t.row.id),["stop"])},{default:s(()=>[c(" 设为已读 ")]),_:2},1032,["onClick"])):(d(),h(r,{key:1,type:"info",size:"small",onClick:Q(x=>q(t.row),["stop"])},{default:s(()=>[c(" 查看 ")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])),[[ue,S.value]])]),o("div",Be,[a(ce,{background:"","current-page":p.pageNum,"onUpdate:currentPage":l[2]||(l[2]=t=>p.pageNum=t),"page-size":p.pageSize,"onUpdate:pageSize":l[3]||(l[3]=t=>p.pageSize=t),"page-sizes":[10,20,50,100],small:!1,layout:"total, sizes, prev, pager, next, jumper",total:L.value,onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1}),a(de,{modelValue:y.value,"onUpdate:modelValue":l[5]||(l[5]=t=>y.value=t),title:(($=i.value)==null?void 0:$.title)||"通知详情",width:"600px",class:"notice-detail-dialog","close-on-click-modal":!1,transition:"el-zoom-in-center"},{footer:s(()=>{var t;return[o("div",Ge,[a(r,{onClick:l[4]||(l[4]=x=>y.value=!1),class:"close-btn"},{default:s(()=>[c("关闭")]),_:1}),((t=i.value)==null?void 0:t.isRead)===0?(d(),h(r,{key:0,type:"primary",onClick:W,class:"mark-read-btn"},{default:s(()=>[c(" 标记为已读 ")]),_:1})):I("",!0)])]}),default:s(()=>{var t,x,j,E,K;return[o("div",He,[o("div",$e,[o("div",je,[a(T,{class:me(["notice-icon",X((t=i.value)==null?void 0:t.type)])},{default:s(()=>{var z;return[(d(),h(O(U((z=i.value)==null?void 0:z.type))))]}),_:1},8,["class"]),a(H,{type:((x=i.value)==null?void 0:x.isRead)===0?"danger":"success",size:"small",effect:"dark",class:"status-tag"},{default:s(()=>{var z;return[c(_(((z=i.value)==null?void 0:z.isRead)===0?"未读":"已读"),1)]}),_:1},8,["type"])]),o("div",Ee,[a(T,null,{default:s(()=>[a(V(Ce))]),_:1}),o("span",null,_(B((j=i.value)==null?void 0:j.datetime)),1)])]),o("div",Ke,[o("div",Pe,[Je,o("p",Oe,_(((E=i.value)==null?void 0:E.description)||"暂无描述信息"),1)]),(K=i.value)!=null&&K.details?(d(),J("div",Qe,[Ze,o("pre",Fe,_(JSON.stringify(i.value.details,null,2)),1)])):I("",!0)])])]}),_:1},8,["modelValue","title"])])}}});const lt=Ne(We,[["__scopeId","data-v-1cb7e28b"]]);export{lt as default};

import{e as ge,f as he,_ as we}from"./index-87a91d15.js";import{p as be,k as ye,s as Ce,i as ke}from"./index-aca84fa4.js";import{r as De,H as j,p as Se,W as $,a as Ve,b as Ne}from"./level.css_vue_type_style_index_0_src_true_lang-0d3ca05e.js";import{K as xe,B as Ie,M as ze,V as Re,N as Te,O as Le,E as N}from"./element-4f7446fd.js";import{p as Ue,r as m,aE as Be,Z as Ae,ai as s,aq as Ee,q as d,t as E,P as F,M as h,O as t,v as w,U as e,F as H,a8 as W,u as v,S as c,I as Me,T as b,R as K}from"./vue-8cd83afb.js";import{v as Oe,b as Pe,g as Q,c as qe}from"./level-407f4ac4.js";import"./vxe-d278ed3b.js";const je={class:"app-container"},$e={class:"toolbar-wrapper"},Fe={class:"table-wrapper"},He={class:"hostname-display"},We={class:"demo-pagination-block"},Ke=Ue({__name:"index",setup(Qe){const C=m(!1),Z=Be(),J=m(!1),k=m(),T=m(10),L=m(1),U=m(0),z=m(0),g={pageSize:20,pageNum:1},p=Ae({agentId:"",level:0}),D=()=>{C.value=!0,be({pageNum:g.pageNum,pageSize:g.pageSize}).then(l=>{if(l.data){const{pageSize:n,pageNum:o,total:r,pages:_,list:u}=l.data;k.value=u||[],T.value=n,U.value=_,L.value=o,z.value=r}else k.value=[]}).catch(()=>{k.value=[]}).finally(()=>{C.value=!1})};function G(){De().then(l=>{A.value=(l==null?void 0:l.data)||[]})}function S(l){const n=JSON.parse(l),o=n.vulnerableType;if(o==j)return Se(n)[0]||{};if(o==$)return Ve(n)[0]||{};{const r=n.flowData,_=Ne(r),u=_.length;return _[u-1]||{}}}function B(l){return l==j?2:l==$?3:1}const M=m([]),A=m([]);function X(l){M.value=l||[]}function O(l){Le.confirm("确定删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{C.value=!0,ye(l).then(()=>{N({type:"success",message:"删除成功"}),D()}).catch(n=>{console.error("删除漏洞失败:",n),N({type:"error",message:"删除失败"})}).finally(()=>{C.value=!1})}).catch(()=>{N({type:"info",message:"删除取消"})})}function Y(){const l=[];for(const n of M.value)l.push(n.id);O(l.join(","))}function ee(){const l="/api/v1/report/export",n=ge();he({method:"get",baseURL:l,data:{},headers:{Authorization:n?`Bearer ${n}`:void 0},responseType:"blob"}).then(o=>{const r=o.data;if(!r)return;const _=window.URL.createObjectURL(new Blob([r])),u=document.createElement("a");u.style.display="none",u.href=_,u.setAttribute("download","report-"+qe()+".json"),document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(u.href),document.body.removeChild(u)}).catch(o=>{N.error("导出失败,原因:"+o)})}const te=l=>{Z.push(`/vuln/detail/${l}`)},ae=l=>{g.pageSize=l,D()},le=l=>{g.pageNum=l,D()},ne=()=>{const l=p.agentId,n=p.level;if(l==null||l==""&&n==0){D();return}Ce({url:l,level:n!==0?n:void 0}).then(o=>{let r=[];Array.isArray(o)?r=o:o.data&&Array.isArray(o.data)&&(r=o.data),k.value=r,z.value=r.length,T.value=r.length,U.value=1,L.value=1}).catch(()=>{k.value=[],T.value=0,U.value=0,L.value=0,z.value=0})},oe=()=>{p.agentId="",p.level=0};function se(l,n){ke(l,n).then(()=>{const o=A.value.find(r=>r.statusId===n);o&&N.success("漏洞状态已切换成"+o.statusName)}).catch(o=>{console.error("修改漏洞状态失败:",o),N.error("修改漏洞状态失败")})}return D(),G(),(l,n)=>{const o=s("el-input"),r=s("el-form-item"),_=s("el-option"),u=s("el-select"),x=s("el-button"),re=s("el-form"),P=s("el-card"),V=s("el-tooltip"),y=s("el-table-column"),ue=s("el-link"),f=s("el-col"),I=s("el-text"),R=s("el-row"),ie=s("el-tag"),de=s("More"),ce=s("el-icon"),pe=s("el-dropdown-item"),_e=s("el-dropdown-menu"),fe=s("el-dropdown"),me=s("el-table"),ve=s("el-pagination"),q=Ee("loading");return d(),E("div",je,[F((d(),h(P,{shadow:"never",class:"search-wrapper"},{default:t(()=>[w("div",null,[e(re,{ref:"searchFormRef",inline:!0,model:p},{default:t(()=>[e(r,{prop:"url",label:"应用ID"},{default:t(()=>[e(o,{modelValue:p.agentId,"onUpdate:modelValue":n[0]||(n[0]=a=>p.agentId=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(r,{prop:"level",label:"漏洞等级"},{default:t(()=>[e(u,{modelValue:p.level,"onUpdate:modelValue":n[1]||(n[1]=a=>p.level=a),style:{width:"80px"}},{default:t(()=>[(d(!0),E(H,null,W(v(Oe),a=>(d(),h(_,{label:v(Q)(a.value),value:a.value,key:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:t(()=>[e(x,{type:"primary",icon:v(xe),onClick:ne},{default:t(()=>[c("查询")]),_:1},8,["icon"]),e(x,{icon:v(Ie),onClick:oe},{default:t(()=>[c("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])])]),_:1})),[[q,C.value]]),F((d(),h(P,{shadow:"never"},{default:t(()=>[w("div",$e,[w("div",null,[e(x,{type:"danger",icon:v(ze),onClick:Y},{default:t(()=>[c("批量删除")]),_:1},8,["icon"])]),w("div",null,[e(V,{content:"导出报告"},{default:t(()=>[e(x,{type:"primary",icon:v(Re),circle:"",onClick:ee},null,8,["icon"])]),_:1}),e(V,{content:"刷新当前页"},{default:t(()=>[e(x,{type:"primary",icon:v(Te),circle:"",onClick:D},null,8,["icon"])]),_:1})])]),w("div",Fe,[e(me,{ref:"multipleTableRef",data:k.value,style:{width:"100%"},onSelectionChange:X},{default:t(()=>[e(y,{type:"selection",width:"55"}),e(y,{prop:"level",label:"漏洞等级",width:"120",sortable:""},{default:t(a=>[w("span",{class:Me(v(Pe)(a.row.level))},b(v(Q)(a.row.level)),3)]),_:1}),e(y,{label:"漏洞概述",align:"left",width:"600"},{default:t(a=>[e(f,null,{default:t(()=>[e(R,{span:5},{default:t(()=>[e(f,{span:8},{default:t(()=>[e(ue,{type:"primary",onClick:i=>te(a.row.id)},{default:t(()=>[c(b(a.row.vulnerableTypeZH),1)]),_:2},1032,["onClick"])]),_:2},1024),e(f,{span:16},{default:t(()=>[e(I,null,{default:t(()=>[c("keypoint")]),_:1})]),_:1})]),_:2},1024),B(a.row.vulnerableType)==1?(d(),h(R,{key:0,span:15},{default:t(()=>[e(f,{span:8},{default:t(()=>[e(V,{content:a.row.uri,placement:"bottom-end"},{default:t(()=>[e(I,{truncated:"",class:"v-descrption"},{default:t(()=>[c(b(a.row.requestMethod)+" "+b(a.row.uri),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024),e(f,{span:16},{default:t(()=>[e(V,{placement:"bottom-end",content:S(a.row.findingData).sign},{default:t(()=>[e(I,{truncated:"",class:"v-descrption"},{default:t(()=>[c(b(S(a.row.findingData).sign),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1024)):B(a.row.vulnerableType)==2?(d(),h(R,{key:1,span:15},{default:t(()=>[e(f,{span:8}),e(f,{span:16},{default:t(()=>[e(V,{placement:"bottom-end",content:S(a.row.findingData).className},{default:t(()=>[e(I,{truncated:"",class:"v-descrption"},{default:t(()=>[c(b(S(a.row.findingData).className),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1024)):B(a.row.vulnerableType)==3?(d(),h(R,{key:2,span:15},{default:t(()=>[e(f,{span:8}),e(f,{span:16},{default:t(()=>[e(V,{placement:"bottom-end",content:S(a.row.findingData).url},{default:t(()=>[e(I,{truncated:"",class:"v-descrption"},{default:t(()=>[c(b(S(a.row.findingData).url),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),_:2},1024)):K("",!0)]),_:2},1024)]),_:1}),e(y,{label:"服务器名称",prop:"agent.hostname",sortable:"",width:"180"},{default:t(a=>[w("div",He,[e(ie,{size:"default",type:"info",effect:"light"},{default:t(()=>{var i;return[c(b(((i=a.row.agent)==null?void 0:i.hostname)||"-"),1)]}),_:2},1024)])]),_:1}),e(y,{label:"最近上报时间",prop:"lastTimestamp",sortable:""}),e(y,{width:"160",label:"状态",prop:"status.statusName",sortable:""},{default:t(a=>[a?(d(),h(u,{key:0,modelValue:a.row.status.statusId,"onUpdate:modelValue":i=>a.row.status.statusId=i,onChange:i=>se(a.row.id,a.row.status.statusId)},{default:t(()=>[(d(!0),E(H,null,W(A.value,i=>(d(),h(_,{label:i.statusName,value:i.statusId,key:i.statusId},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):K("",!0)]),_:1}),e(y,{label:"选项",prop:""},{default:t(a=>[e(fe,null,{dropdown:t(()=>[e(_e,null,{default:t(()=>[e(pe,{onClick:i=>O(a.row.id)},{default:t(()=>[c("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[e(ce,{style:{cursor:"pointer"}},{default:t(()=>[e(de)]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])]),w("div",We,[e(ve,{"current-page":g.pageNum,"onUpdate:currentPage":n[2]||(n[2]=a=>g.pageNum=a),"page-size":g.pageSize,"onUpdate:pageSize":n[3]||(n[3]=a=>g.pageSize=a),"page-sizes":[10,20,50,100],small:!1,disabled:J.value,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:ae,onCurrentChange:le},null,8,["current-page","page-size","disabled","total"])])]),_:1})),[[q,C.value]])])}}});const at=we(Ke,[["__scopeId","data-v-9400f66a"]]);export{at as default};

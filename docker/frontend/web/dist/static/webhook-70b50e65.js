import{K as Le,B as Y,y as $,M as A,N as Z,$ as Be,a0 as Ie,E as i,O as Q,a1 as Pe}from"./element-4f7446fd.js";import{j as V,_ as Re}from"./index-87a91d15.js";import{p as De,r as p,Z as X,b as He,ai as c,aq as $e,q as _,t as y,U as o,O as a,v as s,u as d,S as v,P as ee,M as W,T as P,F as U,a8 as E,aH as Ae,aI as Me}from"./vue-8cd83afb.js";import"./vxe-d278ed3b.js";function qe(u){return V({url:"/webhook",method:"post",data:u})}function Fe(u,b){return V({url:`/webhook/${u}`,method:"put",data:b})}function le(u){return V({url:`/webhook/${u}`,method:"delete"})}function Ke(u){return V({url:`/webhook/${u}`,method:"get"})}function Ge(u){return V({url:"/webhook/list",method:"get",params:u})}function je(u,b){return V({url:`/webhook/${u}/status`,method:"put",params:{status:b}})}function Je(u){return V({url:"/webhook/test",method:"post",data:u})}const Ye=[{label:"新漏洞发现",value:"VULNERABILITY_NEW"},{label:"漏洞状态更新",value:"VULNERABILITY_UPDATE"},{label:"Agent上线",value:"AGENT_ONLINE"},{label:"Agent下线",value:"AGENT_OFFLINE"}],Ze=[{label:"POST",value:"POST"},{label:"GET",value:"GET"}],Qe=[{label:"禁用",value:0},{label:"启用",value:1}],x=u=>(Ae("data-v-55756046"),u=u(),Me(),u),Xe={class:"setting-container"},el=x(()=>s("div",{class:"tip custom-block"},[s("p",{class:"custom-block-title"},"说明"),s("p",null,"Webhook用于在特定事件发生时向指定URL发送通知。"),s("p",null,"您可以配置自定义请求头、触发事件和状态等参数。")],-1)),ll={class:"toolbar-wrapper"},tl={class:"table-wrapper"},ol={class:"url-text"},al={class:"event-tags"},nl={class:"demo-pagination-block"},sl={class:"form-section distributed-section"},rl=x(()=>s("h3",{class:"section-title"},"基本信息",-1)),ul={class:"section-content"},cl={class:"form-section distributed-section"},il=x(()=>s("h3",{class:"section-title"},"自定义请求头",-1)),dl={class:"headers-table"},ml=x(()=>s("div",{class:"table-header"},[s("span",{class:"header-cell key-col"},"Header Key"),s("span",{class:"header-cell value-col"},"Header Value"),s("span",{class:"header-cell action-col"},"操作")],-1)),pl={class:"distributed-columns"},hl={class:"form-section distributed-section column-section"},_l=x(()=>s("h3",{class:"section-title"},"触发事件",-1)),fl={class:"event-checkbox-grid"},vl={class:"checkbox-label"},bl={class:"form-section distributed-section column-section"},gl=x(()=>s("h3",{class:"section-title"},"其他设置",-1)),kl=De({__name:"webhook",setup(u){const b=p(1),N=p(10),R=p(0),O=p(""),S=p(!1),D=p([]),z=p([]),te=p(),M=X({name:""}),C=p(!1),H=p("添加Webhook"),T=p(!1),L=p(null),B=p({}),oe={name:[{required:!0,message:"请输入Webhook名称",trigger:"blur"},{min:1,max:50,message:"名称长度在 1 到 50 个字符",trigger:"blur"}],url:[{required:!0,message:"请输入Webhook URL",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}],events:[{required:!0,message:"请至少选择一个触发事件",trigger:"change"}]},r=X({name:"",url:"",method:"POST",headers:"",events:[],status:1,description:""}),g=p([{key:"",value:""}]),ae=t=>{r.method=t},ne=()=>{g.value.push({key:"",value:""})},se=t=>{g.value.length>1&&g.value.splice(t,1)},re=()=>{const t={};return g.value.forEach(e=>{e.key&&(t[e.key]=e.value||"")}),JSON.stringify(t)},ue=t=>{g.value=[];try{const e=t?JSON.parse(t):{};for(const[n,m]of Object.entries(e))g.value.push({key:n,value:String(m)})}catch{}g.value.length===0&&g.value.push({key:"",value:""})},ce=()=>{r.name="",r.url="",r.method="POST",r.headers="",r.events=[],r.status=1,g.value=[{key:"",value:""}],L.value=null},ie=()=>{H.value="添加Webhook",ce(),C.value=!0},de=async t=>{try{T.value=!0;const e=await Ke(t),n=e==null?void 0:e.data;if(!n){i.error("获取Webhook详情失败：数据格式不正确");return}r.name=n.name,r.url=n.url,r.method=n.method,r.headers=n.headers,r.events=n.events,r.status=n.status,r.description=n.description||"",ue(n.headers),L.value=t,H.value="编辑Webhook",C.value=!0}catch(e){i.error("获取Webhook详情失败"),console.error("获取Webhook详情失败:",e)}finally{T.value=!1}},me=async()=>{try{T.value=!0;const t={...r};t.headers=re();let e;L.value?(e=await Fe(L.value,t),i.success("更新成功")):(e=await qe(t),i.success("创建成功")),e!=null&&e.data&&(C.value=!1,k())}catch(t){i.error("操作失败"),console.error("Webhook保存失败:",t)}finally{T.value=!1}},pe=(t,e)=>{Q.confirm(`确定要删除Webhook "${e}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await le(t),i.success("删除成功"),k()}catch{i.error("删除失败")}}).catch(()=>{})},he=()=>{M.name="",O.value="",b.value=1,k()},_e=t=>{z.value=t},fe=()=>{if(z.value.length===0){i.warning("请选择要删除的Webhook");return}const t=[];for(const e of z.value)t.push(e.id);Q.confirm(`确定删除选中的${t.length}个Webhook？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(async()=>{try{S.value=!0,await Promise.all(t.map(e=>le(e))),i.success("删除成功"),k()}catch{i.error("删除失败")}finally{S.value=!1}}).catch(()=>{i.info("取消删除")})},ve=async(t,e)=>{try{const n=e===1?0:1;await je(t,n),i.success(n===1?"启用成功":"禁用成功"),k()}catch{i.error("状态更新失败"),k()}},be=(t,e)=>{let n;typeof e=="boolean"?n=e?1:0:n=Number(e),ve(t,n)},ge=async(t,e)=>{try{B.value[t]=!0;const n={name:e.name,url:e.url,method:e.method,headers:e.headers,events:e.events,status:1,description:""},m=await Je(n);Pe({title:m.flag?"测试成功":"测试失败",message:m.message||"测试连接成功",type:m.flag?"success":"error",duration:3e3})}catch{i.error("测试连接失败")}finally{B.value[t]=!1}},ke=()=>{b.value=1,k()},k=async()=>{try{S.value=!0;const t=await Ge({pageNum:b.value,pageSize:N.value,name:O.value}),e=t==null?void 0:t.data;e?(D.value=e.list||[],R.value=e.total||0):(D.value=[],R.value=0,i.warning("获取的数据格式不正确"))}catch(t){i.error("获取Webhook列表失败"),console.error("获取Webhook列表失败:",t)}finally{S.value=!1}},we=t=>({vuln_new:"success",vuln_status_changed:"warning",app_online:"info",app_offline:"info",scan_start:"primary",scan_end:"primary"})[t]||"info",ye=t=>({vuln_new:"漏洞新增",vuln_status_changed:"漏洞状态变更",app_online:"应用上线",app_offline:"应用下线",scan_start:"扫描开始",scan_end:"扫描结束"})[t]||t,Ve=t=>{b.value=t,k()},Ce=t=>{N.value=t,b.value=1,k()},Te=()=>!0;return He(()=>{k()}),(t,e)=>{const n=c("el-input"),m=c("el-form-item"),f=c("el-button"),q=c("el-form"),F=c("el-card"),We=c("el-tooltip"),w=c("el-table-column"),K=c("el-tag"),xe=c("el-switch"),Se=c("el-button-group"),Ue=c("el-table"),Ee=c("el-pagination"),G=c("el-option"),j=c("el-select"),Ne=c("el-checkbox"),Oe=c("el-checkbox-group"),ze=c("el-dialog"),J=$e("loading");return _(),y("div",Xe,[el,o(F,{shadow:"never",class:"search-wrapper"},{default:a(()=>[s("div",null,[o(q,{inline:!0,model:M},{default:a(()=>[o(m,{prop:"name",label:"Webhook名称"},{default:a(()=>[o(n,{placeholder:"请输入",modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=l=>O.value=l)},null,8,["modelValue"])]),_:1}),o(m,null,{default:a(()=>[o(f,{type:"primary",icon:d(Le),onClick:ke},{default:a(()=>[v("查询")]),_:1},8,["icon"]),o(f,{icon:d(Y),onClick:he},{default:a(()=>[v("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])])]),_:1}),o(F,{shadow:"never"},{default:a(()=>[s("div",ll,[s("div",null,[o(f,{type:"primary",icon:d($),onClick:ie},{default:a(()=>[v("添加Webhook")]),_:1},8,["icon"]),o(f,{type:"danger",icon:d(A),onClick:fe,disabled:!z.value.length},{default:a(()=>[v("批量删除")]),_:1},8,["icon","disabled"])]),s("div",null,[o(We,{content:"刷新当前页"},{default:a(()=>[o(f,{type:"primary",icon:d(Z),circle:"",onClick:k},null,8,["icon"])]),_:1})])]),s("div",tl,[ee((_(),W(Ue,{ref_key:"multipleTableRef",ref:te,data:D.value,style:{width:"100%"},"empty-text":"暂无数据",onSelectionChange:_e},{default:a(()=>[o(w,{type:"selection",width:"55"}),o(w,{prop:"name",label:"Webhook名称",width:"200"}),o(w,{prop:"url",label:"URL","show-overflow-tooltip":""},{default:a(l=>[s("div",ol,P(l.row.url),1)]),_:1}),o(w,{prop:"method",label:"请求方法",width:"100"},{default:a(l=>[o(K,{type:l.row.method==="POST"?"success":"primary"},{default:a(()=>[v(P(l.row.method),1)]),_:2},1032,["type"])]),_:1}),o(w,{prop:"events",label:"触发事件",width:"200"},{default:a(l=>[s("div",al,[(_(!0),y(U,null,E(l.row.events,h=>(_(),W(K,{key:h,type:we(h),size:"small",effect:"light"},{default:a(()=>[v(P(ye(h)),1)]),_:2},1032,["type"]))),128))])]),_:1}),o(w,{prop:"status",label:"状态",width:"140"},{default:a(l=>[o(xe,{modelValue:l.row.status,"onUpdate:modelValue":h=>l.row.status=h,"active-value":1,"inactive-value":0,onChange:h=>be(l.row.id,h)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(w,{prop:"createdTime",label:"创建时间",width:"180"}),o(w,{label:"操作",width:"300",fixed:"right"},{default:a(l=>[o(Se,null,{default:a(()=>[o(f,{size:"small",type:"primary",icon:d(Be),onClick:h=>de(l.row.id)},{default:a(()=>[v(" 编辑 ")]),_:2},1032,["icon","onClick"]),o(f,{size:"small",type:"danger",icon:d(A),onClick:h=>pe(l.row.id,l.row.name)},{default:a(()=>[v(" 删除 ")]),_:2},1032,["icon","onClick"]),o(f,{size:"small",type:"info",icon:B.value[l.row.id]?d(Y):d(Z),loading:B.value[l.row.id],onClick:h=>ge(l.row.id,l.row)},{default:a(()=>[v(" 测试 ")]),_:2},1032,["icon","loading","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[J,S.value]])]),s("div",nl,[o(Ee,{"current-page":b.value,"onUpdate:currentPage":e[1]||(e[1]=l=>b.value=l),"page-size":N.value,"onUpdate:pageSize":e[2]||(e[2]=l=>N.value=l),"page-sizes":[10,20,50,100],small:!1,disabled:!1,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:R.value,onSizeChange:Ce,onCurrentChange:Ve},null,8,["current-page","page-size","total"])])]),_:1}),o(ze,{modelValue:C.value,"onUpdate:modelValue":e[10]||(e[10]=l=>C.value=l),title:H.value,width:"700px","close-on-click-modal":!1,"close-on-press-escape":!1,class:"webhook-dialog distributed-layout","before-close":Te},{footer:a(()=>[o(f,{onClick:e[9]||(e[9]=l=>C.value=!1),class:"footer-btn"},{default:a(()=>[v("取消")]),_:1}),o(f,{type:"primary",onClick:me,loading:T.value,class:"footer-btn primary-btn"},{default:a(()=>[v(" 确定 ")]),_:1},8,["loading"])]),default:a(()=>[ee((_(),W(q,{model:r,rules:oe,ref:"formRef","label-width":"100px",size:"default",class:"webhook-form"},{default:a(()=>[s("div",sl,[rl,s("div",ul,[o(m,{label:"Webhook名称",prop:"name",class:"webhook-form-item"},{default:a(()=>[o(n,{modelValue:r.name,"onUpdate:modelValue":e[3]||(e[3]=l=>r.name=l),placeholder:"请输入Webhook名称","prefix-icon":d($),clearable:"",class:"form-input"},null,8,["modelValue","prefix-icon"])]),_:1}),o(m,{label:"Webhook URL",prop:"url",class:"webhook-form-item"},{default:a(()=>[o(n,{modelValue:r.url,"onUpdate:modelValue":e[4]||(e[4]=l=>r.url=l),placeholder:"请输入Webhook URL","prefix-icon":d(Ie),clearable:"","show-word-limit":"",maxlength:"255",class:"form-input"},null,8,["modelValue","prefix-icon"])]),_:1}),o(m,{label:"请求方法",class:"webhook-form-item"},{default:a(()=>[o(j,{modelValue:r.method,"onUpdate:modelValue":e[5]||(e[5]=l=>r.method=l),placeholder:"请选择请求方法",onChange:ae,class:"method-select"},{default:a(()=>[(_(!0),y(U,null,E(d(Ze),l=>(_(),W(G,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),s("div",cl,[il,o(m,{class:"webhook-form-item"},{default:a(()=>[s("div",dl,[ml,(_(!0),y(U,null,E(g.value,(l,h)=>(_(),y("div",{key:h,class:"table-row"},[o(n,{modelValue:l.key,"onUpdate:modelValue":I=>l.key=I,placeholder:"Header Key",class:"header-input key-input",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),o(n,{modelValue:l.value,"onUpdate:modelValue":I=>l.value=I,placeholder:"Header Value",class:"header-input value-input",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),o(f,{type:"danger",icon:d(A),circle:"",size:"small",onClick:I=>se(h),disabled:g.value.length===1,tooltip:"删除该行"},null,8,["icon","onClick","disabled"])]))),128)),o(f,{type:"primary",size:"small",onClick:ne,icon:d($)},{default:a(()=>[v(" 添加表头 ")]),_:1},8,["icon"])])]),_:1})]),s("div",pl,[s("div",hl,[_l,o(m,{label:"",prop:"events",class:"webhook-form-item"},{default:a(()=>[o(Oe,{modelValue:r.events,"onUpdate:modelValue":e[6]||(e[6]=l=>r.events=l),class:"checkbox-wrapper"},{default:a(()=>[s("div",fl,[(_(!0),y(U,null,E(d(Ye),l=>(_(),W(Ne,{key:l.value,label:l.value,class:"event-checkbox-item"},{default:a(()=>[s("span",vl,P(l.label),1)]),_:2},1032,["label"]))),128))])]),_:1},8,["modelValue"])]),_:1})]),s("div",bl,[gl,o(m,{label:"状态",class:"webhook-form-item"},{default:a(()=>[o(j,{modelValue:r.status,"onUpdate:modelValue":e[7]||(e[7]=l=>r.status=l),placeholder:"请选择状态",class:"status-select"},{default:a(()=>[(_(!0),y(U,null,E(d(Qe),l=>(_(),W(G,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"备注",class:"webhook-form-item"},{default:a(()=>[o(n,{modelValue:r.description,"onUpdate:modelValue":e[8]||(e[8]=l=>r.description=l),type:"textarea",rows:3,placeholder:"请输入备注信息（可选）","show-word-limit":"",maxlength:"200",resize:"none",class:"form-textarea"},null,8,["modelValue"])]),_:1})])])]),_:1},8,["model"])),[[J,T.value]])]),_:1},8,["modelValue","title"])])}}});const Tl=Re(kl,[["__scopeId","data-v-55756046"]]);export{Tl as default};

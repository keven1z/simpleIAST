import{p as Te,r as C,aE as xe,ai as u,q as n,t as d,U as t,O as e,I as Ce,u as R,T as i,R as h,S as m,M as g,F as $,a8 as P,v as s,aH as Ie,aI as ze}from"./vue-8cd83afb.js";import{b as Ve,g as De,c as Re}from"./level-407f4ac4.js";import{H as Se,p as Le,W as Ue,a as qe,b as Ne,r as Ae}from"./level.css_vue_type_style_index_0_src_true_lang-1343085c.js";import{f as Ee,h as He,i as Be,j as Oe}from"./index-28bcc963.js";import{e as $e,f as Pe,_ as Fe}from"./index-db029066.js";import{g as We}from"./index-d4f56773.js";import{V as Me,W as je,X as Z,Y as Je,E as k}from"./element-4f7446fd.js";import"./vxe-d278ed3b.js";const Qe="/static/sanitizer_icon-58a9c1c4.svg";function ee(b){const f=Object.entries(b).sort(([_],[T])=>_==="host"||_==="referer"?-1:T==="host"||T==="referer"?1:_.localeCompare(T));let z="";return f.forEach(([_,T])=>{_=_.replace(/(?:^|-)([a-z])/g,V=>V.toUpperCase()),z=z+_+": "+T+`\r
`}),z}function Ge(b,f,z,_,T){const V=ee(z);f=f.toUpperCase();let U=`${f} ${b} ${T}\r
`;return U+=V,_!=null&&(U+=`\r
${atob(_)}`),U}function Ke(b,f,z){const _=ee(z);return`${b} ${f}\r
${_}`}function Xe(b){return b.className+"."+b.method+b.desc}const L=b=>(Ie("data-v-f927b949"),b=b(),ze(),b),Ye={key:0},Ze={key:1},et={key:2},tt={key:0},at=L(()=>s("strong",null,"所属应用:",-1)),st={key:0},nt=L(()=>s("strong",null,"首次发现时间:",-1)),lt={key:0},ot=L(()=>s("strong",null,"最新发现时间:",-1)),ct={class:"custom-label"},rt={key:0},it={class:"parent-node-sign"},ut={class:"left-content"},dt={class:"phase-sign"},_t={class:"right-content"},pt={key:0,src:Qe,alt:"",class:"sanitizer-icon"},mt={key:1},vt={class:"call-stack-container"},ft={class:"call-stack-header"},ht=L(()=>s("span",{class:"stack-title"},"调用栈信息",-1)),gt={key:0,class:"stack-count"},yt={class:"call-stack-content"},kt={key:0,class:"stack-list"},bt={class:"frame-index"},wt={class:"frame-content"},Tt={class:"frame-text"},xt={key:1,class:"stack-empty"},Ct={key:2},It={class:"sanitizer-text-container"},zt={class:"sanitizer-index"},Vt={key:1,class:"no-sanitizer"},Dt={key:3},Rt={class:"detail-item"},St={class:"detail-label"},Lt={class:"detail-value"},Ut={class:"http-container"},qt={class:"http-left-pane"},Nt={class:"http-header"},At=L(()=>s("h3",null,"HTTP请求",-1)),Et={class:"http-content"},Ht={class:"http-code"},Bt={class:"http-right-pane"},Ot={class:"http-header"},$t=L(()=>s("h3",null,"HTTP响应",-1)),Pt={class:"http-content"},Ft={class:"http-code"},Wt={class:"comments-header"},Mt=L(()=>s("span",{class:"header-title"},"评论",-1)),jt={class:"comment-count"},Jt={class:"comment-input-section"},Qt={class:"comment-input-header"},Gt={class:"user-name"},Kt={class:"comment-actions"},Xt={class:"comments-list"},Yt={key:0,class:"comment-items"},Zt={class:"comment-body"},ea={class:"comment-header"},ta={class:"author-name"},aa={class:"comment-time"},sa={class:"comment-content"},na={key:1,class:"no-comments"},la=Te({__name:"detail",setup(b){const f=C(),z=xe(),_=C([]),T=C(),V=C(),U=C("first"),r=C(null),W=C([]),q=C([]),N=C(""),A=C(!1),H=C({userId:"1",username:"当前用户",password:"",email:"",phone:"",roleId:"",roleName:"",createTime:"",updateTime:"",status:1,lastLoginTime:""}),te=()=>new Promise((a,o)=>{const l=z.currentRoute.value.params.id;Oe(l).then(p=>{p&&p.data?r.value=p.data.data||p.data:r.value=p||{},r.value,a(p)}).catch(p=>{console.error("获取漏洞详情失败:",p),k.error("获取漏洞详情失败，请稍后重试"),o(p)})});function ae(){if(!T.value){k.warning("没有可复制的请求内容");return}navigator.clipboard.writeText(T.value).then(()=>{k.success("文本已成功复制到剪贴板")}).catch(a=>{k.error("复制到剪贴板失败: "+a.message)})}function se(){if(!V.value){k.warning("没有可复制的响应内容");return}navigator.clipboard.writeText(V.value).then(()=>{k.success("文本已成功复制到剪贴板")}).catch(a=>{k.error("复制到剪贴板失败: "+a.message)})}function ne(){var l,p;const a=r.value||{};let o="{}";return a.findingData?o=a.findingData:a.data&&a.data.findingData?o=a.data.findingData:a.data&&a.data.list&&a.data.list[0]&&a.data.list[0].findingData&&(o=a.data.list[0].findingData),typeof o!="string"&&(o=JSON.stringify(o||{})),{...a,...a.data||{},...((p=(l=a.data)==null?void 0:l.list)==null?void 0:p[0])||{},findingData:o}}function le(){return new Promise((a,o)=>{Ae().then(l=>{l.data?(W.value=(l==null?void 0:l.data)||[],a((l==null?void 0:l.data)||[])):(console.error("获取状态列表失败:",l.message),o(new Error(l.message||"获取状态列表失败")))}).catch(l=>{console.error("获取漏洞状态失败:",l),k.error("获取漏洞状态失败，请稍后重试"),o(l)})})}async function oe(){try{await te(),re(),le(),M();try{const a=await We();""+a,a&&a.data&&(H.value=a.data,H.value)}catch(a){console.error("获取当前用户信息失败:",a)}}catch(a){console.error("获取数据失败:",a)}}async function M(){var a;A.value=!0;try{const o=(a=r.value)==null?void 0:a.id;if(!o){console.error("无法获取漏洞ID");return}const l=await Ee(o);q.value=(l==null?void 0:l.data)||[]}catch(o){console.error("获取评论失败:",o),k.error("获取评论失败，请稍后重试")}finally{A.value=!1}}async function ce(){var a;if(!N.value.trim()){k.warning("请输入评论内容");return}A.value=!0;try{const o=(a=r.value)==null?void 0:a.id;if(!o){console.error("无法获取漏洞ID"),k.error("发表评论失败：无法获取漏洞信息");return}const l={reportId:Number(o),userId:Number(H.value.userId),content:N.value.trim()};await He(l),await M(),N.value="",k.success("评论发表成功")}catch(o){console.error("添加评论失败:",o),k.error("发表评论失败，请稍后重试")}finally{A.value=!1}}function re(){const a=ne(),o=JSON.parse(a.findingData);let l=[];const p=o.vulnerableType;if(p==Se)f.value=2,l=Le(o);else if(p==Ue)f.value=3,l=qe(o),j(a);else{f.value=1;const y=o.flowData;l=Ne(y),j(a)}_.value=l}function j(a){a&&(T.value=Ge(a.uri||"",a.requestMethod||"GET",a.requestHeader||new Map,a.requestBody||"",a.protocol||"http"),V.value=Ke(a.protocol||"http",a.statusCode||200,a.responseHeader||new Map))}function ie(a){if(!r.value)return;const o=r.value.id;Be(o,a).then(l=>{l.flag&&(k.success("修改状态成功"),r.value&&(r.value.status.statusId=a))}).catch(l=>{console.error("修改漏洞状态失败:",l),k.error("修改漏洞状态失败")})}function ue(){const a=`/api/v1/report/exportOne?reportId=${r.value.id}`,o=$e();Pe({method:"get",baseURL:a,data:{},headers:{Authorization:o?`Bearer ${o}`:void 0},responseType:"blob"}).then(l=>{const p=l.data;if(!p)return;const y=window.URL.createObjectURL(new Blob([p])),w=document.createElement("a");w.style.display="none",w.href=y,w.setAttribute("download","report-"+Re()+".json"),document.body.appendChild(w),w.click(),window.URL.revokeObjectURL(w.href),document.body.removeChild(w)}).catch(l=>{k.error("导出失败,原因:"+l)})}return oe(),(a,o)=>{const l=u("el-card"),p=u("el-tag"),y=u("el-text"),w=u("el-col"),de=u("el-option"),_e=u("el-select"),B=u("el-button"),O=u("el-tooltip"),F=u("el-row"),pe=u("ArrowDownBold"),S=u("el-icon"),me=u("ArrowRightBold"),ve=u("WarningFilled"),J=u("el-empty"),fe=u("el-collapse-item"),he=u("el-collapse"),ge=u("el-tree"),ye=u("el-header"),E=u("el-table-column"),Q=u("el-table"),G=u("el-main"),K=u("el-container"),X=u("el-tab-pane"),ke=u("el-tabs"),Y=u("el-avatar"),be=u("el-input");return n(),d("div",null,[t(l,{shadow:"hover",class:"report-card"},{default:e(()=>{var v,c,D;return[r.value?(n(),d("h3",Ye,[r.value?(n(),d("span",{key:0,class:Ce(R(Ve)(r.value.level)),style:{"margin-right":"10px"}},i(R(De)(r.value.level)),3)):h("",!0),f.value==1||f.value==3?(n(),d("span",Ze,i(r.value.url||((D=(c=(v=r.value.data)==null?void 0:v.list)==null?void 0:c[0])==null?void 0:D.url)||"未知URL"),1)):f.value==2?(n(),d("span",et,i(_.value[0].sourceFile),1)):h("",!0),m(" 发现 "+i(r.value.vulnerableTypeZH),1)])):h("",!0)]}),_:1}),t(l,{class:"report-card",shadow:"hover"},{default:e(()=>[t(F,{gutter:10},{default:e(()=>[t(w,{span:6},{default:e(()=>[r.value?(n(),d("div",tt,[at,r.value.agent?(n(),g(p,{key:0,size:"default",type:"info",effect:"light",class:"ml-2"},{default:e(()=>[m(i(r.value.agent.hostname),1)]),_:1})):(n(),g(y,{key:1,class:"ml-2"},{default:e(()=>[m("未知")]),_:1}))])):h("",!0)]),_:1}),t(w,{span:6},{default:e(()=>[r.value?(n(),d("div",st,[nt,r.value.firstTimestamp?(n(),g(y,{key:0},{default:e(()=>[m(i(r.value.firstTimestamp),1)]),_:1})):h("",!0)])):h("",!0)]),_:1}),t(w,{span:6},{default:e(()=>[r.value?(n(),d("div",lt,[ot,r.value.lastTimestamp?(n(),g(y,{key:0},{default:e(()=>[m(i(r.value.lastTimestamp),1)]),_:1})):h("",!0)])):h("",!0)]),_:1}),t(w,{span:6},{default:e(()=>[t(F,{gutter:10},{default:e(()=>[t(w,{span:8},{default:e(()=>[r.value?(n(),g(_e,{key:0,modelValue:r.value.status.statusId,"onUpdate:modelValue":o[0]||(o[0]=v=>r.value.status.statusId=v),onChange:ie},{default:e(()=>[(n(!0),d($,null,P(W.value,v=>(n(),g(de,{label:v.statusName,value:v.statusId,key:v.statusId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):h("",!0)]),_:1}),t(w,{span:6},{default:e(()=>[t(O,{content:"导出漏洞"},{default:e(()=>[t(B,{type:"primary",icon:R(Me),circle:"",onClick:ue},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(l,{class:"report-details",shadow:"hover"},{default:e(()=>[t(ke,{modelValue:U.value,"onUpdate:modelValue":o[1]||(o[1]=v=>U.value=v)},{default:e(()=>[t(X,{label:"漏洞细节",name:"first"},{default:e(()=>[f.value==1?(n(),g(ge,{key:0,indent:16,data:_.value,"node-key":"id",style:{"max-height":"600px","overflow-y":"auto"}},{default:e(({node:v,data:c})=>{var D;return[s("div",ct,[v.level==1?(n(),d("div",rt,[s("div",it,[s("div",ut,[c.name.includes("污染源")?(n(),g(p,{key:0,type:"primary",size:"small",effect:"dark"},{default:e(()=>[t(S,null,{default:e(()=>[t(pe)]),_:1}),m(" 污染源 ")]),_:1})):c.name.includes("传播")?(n(),g(p,{key:1,type:"warning",size:"small",effect:"dark"},{default:e(()=>[t(S,null,{default:e(()=>[t(me)]),_:1}),m(" 传播阶段 ")]),_:1})):c.name.includes("触发")?(n(),g(p,{key:2,type:"danger",size:"small",effect:"dark"},{default:e(()=>[t(S,null,{default:e(()=>[t(ve)]),_:1}),m(" 漏洞触发 ")]),_:1})):h("",!0),s("span",dt,i(c.sign),1)]),s("div",_t,[t(F,{class:"w-600px mb-2"},{default:e(()=>{var x;return[t(O,{content:((x=c.children.find(I=>I.name==="taint"))==null?void 0:x.value)||"",placement:"top-end"},{default:e(()=>[t(y,{class:"taint-highlight",truncated:""},{default:e(()=>{var I;return[m(i(((I=c.children.find(we=>we.name==="taint"))==null?void 0:I.value)||""),1)]}),_:2},1024)]),_:2},1032,["content"]),c.isSanitizer?(n(),d("img",pt)):h("",!0)]}),_:2},1024)])])])):c.name=="stack"&&!((D=v.parent)!=null&&D.data.name.includes("传播"))?(n(),d("div",mt,[s("div",vt,[s("div",ft,[t(S,{class:"stack-icon"},{default:e(()=>[t(R(je))]),_:1}),ht,c.value&&c.value.length>0?(n(),d("span",gt,"("+i(c.value.length)+" 帧)",1)):h("",!0)]),s("div",yt,[c.value&&c.value.length>0?(n(),d("div",kt,[(n(!0),d($,null,P(c.value,(x,I)=>(n(),d("div",{key:I,class:"stack-frame"},[s("div",bt,i(I),1),s("div",wt,[t(O,{content:x,placement:"top",effect:"dark"},{default:e(()=>[s("div",Tt,i(x),1)]),_:2},1032,["content"])])]))),128))])):(n(),d("div",xt,[t(J,{description:"暂无调用栈信息","image-size":60})]))])])])):c.name=="sanitizer"?(n(),d("div",Ct,[t(he,{class:"sanitizer-collapse"},{default:e(()=>[t(fe,{title:"过滤函数",name:"sanitizer"},{default:e(()=>[c.value&&c.value.length>0?(n(!0),d($,{key:0},P(c.value,(x,I)=>(n(),d("div",{key:I},[s("div",It,[s("span",zt,i(I+1)+".",1),t(y,{class:"sanitizer-function"},{default:e(()=>[m(i(R(Xe)(x)),1)]),_:2},1024),t(y,{class:"sanitizer-target"},{default:e(()=>[m(i(x.to),1)]),_:2},1024)])]))),128)):(n(),d("div",Vt,[t(y,{type:"info"},{default:e(()=>[m("暂无过滤函数信息")]),_:1})]))]),_:2},1024)]),_:2},1024)])):(n(),d("div",Dt,[s("div",Rt,[s("div",St,i(c.label),1),s("div",Lt,[t(O,{content:c.value,placement:"top-end"},{default:e(()=>[t(y,{truncated:"",class:"value-text"},{default:e(()=>[m(i(c.value),1)]),_:2},1024)]),_:2},1032,["content"])])])]))])]}),_:1},8,["data"])):f.value==2?(n(),g(K,{key:1},{default:e(()=>[_.value?(n(),g(ye,{key:0},{default:e(()=>[m(" 硬编码漏洞存在于 "),t(y,{tag:"b"},{default:e(()=>[m(i(_.value[0].sourceFile),1)]),_:1}),m(" 文件中, 类路径： "),t(y,{tag:"b"},{default:e(()=>[m(i(_.value[0].className),1)]),_:1})]),_:1})):h("",!0),t(G,null,{default:e(()=>[_.value?(n(),g(Q,{key:0,data:_.value,style:{width:"100%"}},{default:e(()=>[t(E,{prop:"parameterName",label:"参数名"}),t(E,{label:"参数值"},{default:e(v=>[t(y,null,{default:e(()=>[m(i(v.row.parameterValue),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])):h("",!0)]),_:1})]),_:1})):f.value==3?(n(),g(K,{key:2},{default:e(()=>[t(G,null,{default:e(()=>[_.value?(n(),g(Q,{key:0,data:_.value,style:{width:"100%"}},{default:e(()=>[t(E,{prop:"url",label:"数据库连接地址"}),t(E,{prop:"user",label:"用户名"}),t(E,{prop:"password",label:"密码"},{default:e(v=>[t(y,null,{default:e(()=>[m(i(v.row.password),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])):h("",!0)]),_:1})]),_:1})):h("",!0)]),_:1}),f.value==1||f.value==3?(n(),g(X,{key:0,label:"HTTP请求信息",name:"second"},{default:e(()=>[s("div",Ut,[s("div",qt,[s("div",Nt,[At,t(B,{type:"primary",size:"small",onClick:ae},{default:e(()=>[t(S,null,{default:e(()=>[t(R(Z))]),_:1}),m(" 复制 ")]),_:1})]),s("div",Et,[s("pre",Ht,i(T.value),1)])]),s("div",Bt,[s("div",Ot,[$t,t(B,{type:"primary",size:"small",onClick:se},{default:e(()=>[t(S,null,{default:e(()=>[t(R(Z))]),_:1}),m(" 复制 ")]),_:1})]),s("div",Pt,[s("pre",Ft,i(V.value),1)])])])]),_:1})):h("",!0)]),_:1},8,["modelValue"])]),_:1}),r.value?(n(),g(l,{key:0,shadow:"hover",class:"comments-card"},{header:e(()=>[s("div",Wt,[t(S,{class:"header-icon"},{default:e(()=>[t(R(Je))]),_:1}),Mt,s("span",jt,"("+i(q.value.length||0)+")",1)])]),default:e(()=>{var v;return[s("div",Jt,[s("div",Qt,[t(Y,{size:"small",icon:"User",class:"user-avatar"}),s("span",Gt,i((v=H.value)==null?void 0:v.username),1)]),t(be,{modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=c=>N.value=c),type:"textarea",rows:2,maxlength:500,resize:"none",placeholder:"添加评论...","show-word-limit":"",class:"comment-textarea"},null,8,["modelValue"]),s("div",Kt,[t(B,{type:"primary",size:"small",onClick:ce,loading:A.value},{default:e(()=>[m(" 添加评论 ")]),_:1},8,["loading"])])]),s("div",Xt,[q.value&&q.value.length>0?(n(),d("div",Yt,[(n(!0),d($,null,P(q.value,c=>{var D;return n(),d("div",{key:c.id,class:"comment-item"},[t(Y,{size:"small",class:"comment-avatar"},{default:e(()=>{var x;return[m(i((((x=c.user)==null?void 0:x.username)||"用户").charAt(0)),1)]}),_:2},1024),s("div",Zt,[s("div",ea,[s("span",ta,i(((D=c.user)==null?void 0:D.username)||"未知用户"),1),s("span",aa,i(c.createdAt),1)]),s("div",sa,i(c.content),1)])])}),128))])):(n(),d("div",na,[t(J,{description:"暂无评论"})]))])]}),_:1})):h("",!0)])}}});const ma=Fe(la,[["__scopeId","data-v-f927b949"]]);export{ma as default};

import{p as Te,r as C,aE as xe,ai as u,q as l,t as d,U as t,O as e,I as Ce,u as R,T as r,R as h,S as m,M as g,F as $,a8 as P,v as s,aH as Ie,aI as ze}from"./vue-8cd83afb.js";import{b as Ve,g as De,c as Re}from"./level-407f4ac4.js";import{H as Se,p as Le,W as Ue,a as qe,b as Ne,r as Ae}from"./level.css_vue_type_style_index_0_src_true_lang-22aabbe7.js";import{f as Ee,h as He,i as Be,j as Oe}from"./index-3e1c7ec4.js";import{e as $e,f as Pe,_ as Fe}from"./index-7d92c181.js";import{g as We}from"./index-5ff6e48f.js";import{V as Me,W as je,X as Z,Y as Je,E as k}from"./element-25094948.js";import"./vxe-49b9e5de.js";const Qe="/static/sanitizer_icon-58a9c1c4.svg";function ee(b){const f=Object.entries(b).sort(([_],[T])=>_==="host"||_==="referer"?-1:T==="host"||T==="referer"?1:_.localeCompare(T));let z="";return f.forEach(([_,T])=>{_=_.replace(/(?:^|-)([a-z])/g,V=>V.toUpperCase()),z=z+_+": "+T+`\r
`}),z}function Ge(b,f,z,_,T){const V=ee(z);f=f.toUpperCase();let U=`${f} ${b} ${T}\r
`;return U+=V,_!=null&&(U+=`\r
${atob(_)}`),U}function Ke(b,f,z){const _=ee(z);return`${b} ${f}\r
${_}`}function Xe(b){return b.className+"."+b.method+b.desc}const L=b=>(Ie("data-v-875f9a82"),b=b(),ze(),b),Ye={key:0},Ze={key:1},et={key:2},tt={key:0},at=L(()=>s("strong",null,"所属应用:",-1)),st={key:0},lt=L(()=>s("strong",null,"首次发现时间:",-1)),nt={key:0},ot=L(()=>s("strong",null,"最新发现时间:",-1)),ct={class:"custom-label"},it={key:0},rt={class:"parent-node-sign"},ut={class:"left-content"},dt={class:"phase-sign"},_t={class:"right-content"},pt={key:0,src:Qe,alt:"",class:"sanitizer-icon"},mt={key:1},vt={class:"call-stack-container"},ft={class:"call-stack-header"},ht=L(()=>s("span",{class:"stack-title"},"调用栈信息",-1)),gt={key:0,class:"stack-count"},yt={class:"call-stack-content"},kt={key:0,class:"stack-list"},bt={class:"frame-index"},wt={class:"frame-content"},Tt={class:"frame-text"},xt={key:1,class:"stack-empty"},Ct={key:2},It={class:"sanitizer-text-container"},zt={class:"sanitizer-index"},Vt={key:1,class:"no-sanitizer"},Dt={key:3},Rt={class:"detail-item"},St={class:"detail-label"},Lt={class:"detail-value"},Ut={class:"http-container"},qt={class:"http-left-pane"},Nt={class:"http-header"},At=L(()=>s("h3",null,"HTTP请求",-1)),Et={class:"http-content"},Ht={class:"http-code"},Bt={class:"http-right-pane"},Ot={class:"http-header"},$t=L(()=>s("h3",null,"HTTP响应",-1)),Pt={class:"http-content"},Ft={class:"http-code"},Wt={class:"comments-header"},Mt=L(()=>s("span",{class:"header-title"},"评论",-1)),jt={class:"comment-count"},Jt={class:"comment-input-section"},Qt={class:"comment-input-header"},Gt={class:"user-name"},Kt={class:"comment-actions"},Xt={class:"comments-list"},Yt={key:0,class:"comment-items"},Zt={class:"comment-body"},ea={class:"comment-header"},ta={class:"author-name"},aa={class:"comment-time"},sa={class:"comment-content"},la={key:1,class:"no-comments"},na=Te({__name:"detail",setup(b){const f=C(),z=xe(),_=C([]),T=C(),V=C(),U=C("first"),c=C(null),W=C([]),q=C([]),N=C(""),A=C(!1),H=C({userId:"1",username:"当前用户",password:"",email:"",phone:"",roleId:"",roleName:"",createTime:"",updateTime:"",status:1,lastLoginTime:""}),te=()=>new Promise((a,n)=>{const o=z.currentRoute.value.params.id;Oe(o).then(p=>{p&&p.data?c.value=p.data.data||p.data:c.value=p||{},c.value,a(p)}).catch(p=>{console.error("获取漏洞详情失败:",p),k.error("获取漏洞详情失败，请稍后重试"),n(p)})});function ae(){if(!T.value){k.warning("没有可复制的请求内容");return}navigator.clipboard.writeText(T.value).then(()=>{k.success("文本已成功复制到剪贴板")}).catch(a=>{k.error("复制到剪贴板失败: "+a.message)})}function se(){if(!V.value){k.warning("没有可复制的响应内容");return}navigator.clipboard.writeText(V.value).then(()=>{k.success("文本已成功复制到剪贴板")}).catch(a=>{k.error("复制到剪贴板失败: "+a.message)})}function le(){var o,p;const a=c.value||{};let n="{}";return a.findingData?n=a.findingData:a.data&&a.data.findingData?n=a.data.findingData:a.data&&a.data.list&&a.data.list[0]&&a.data.list[0].findingData&&(n=a.data.list[0].findingData),typeof n!="string"&&(n=JSON.stringify(n||{})),{...a,...a.data||{},...((p=(o=a.data)==null?void 0:o.list)==null?void 0:p[0])||{},findingData:n}}function ne(){return new Promise((a,n)=>{Ae().then(o=>{o.data?(W.value=(o==null?void 0:o.data)||[],a((o==null?void 0:o.data)||[])):(console.error("获取状态列表失败:",o.message),n(new Error(o.message||"获取状态列表失败")))}).catch(o=>{console.error("获取漏洞状态失败:",o),k.error("获取漏洞状态失败，请稍后重试"),n(o)})})}async function oe(){try{await te(),ie(),ne(),M();try{const a=await We();""+a,a&&a.data&&(H.value=a.data,H.value)}catch(a){console.error("获取当前用户信息失败:",a)}}catch(a){console.error("获取数据失败:",a)}}async function M(){var a;A.value=!0;try{const n=(a=c.value)==null?void 0:a.id;if(!n){console.error("无法获取漏洞ID");return}const o=await Ee(n);q.value=(o==null?void 0:o.data)||[]}catch(n){console.error("获取评论失败:",n),k.error("获取评论失败，请稍后重试")}finally{A.value=!1}}async function ce(){var a;if(!N.value.trim()){k.warning("请输入评论内容");return}A.value=!0;try{const n=(a=c.value)==null?void 0:a.id;if(!n){console.error("无法获取漏洞ID"),k.error("发表评论失败：无法获取漏洞信息");return}const o={reportId:Number(n),userId:Number(H.value.userId),content:N.value.trim()};await He(o),await M(),N.value="",k.success("评论发表成功")}catch(n){console.error("添加评论失败:",n),k.error("发表评论失败，请稍后重试")}finally{A.value=!1}}function ie(){const a=le(),n=JSON.parse(a.findingData);let o=[];const p=n.vulnerableType;if(p==Se)f.value=2,o=Le(n);else if(p==Ue)f.value=3,o=qe(n),j(a);else{f.value=1;const y=n.flowData;o=Ne(y),j(a)}_.value=o}function j(a){a&&(T.value=Ge(a.uri||"",a.requestMethod||"GET",a.requestHeader||new Map,a.requestBody||"",a.protocol||"http"),V.value=Ke(a.protocol||"http",a.statusCode||200,a.responseHeader||new Map))}function re(a){if(!c.value||!c.value.data||!c.value.data.list||c.value.data.list.length===0)return;const n=c.value.data.list[0].id;Be(n,a).then(o=>{o.code==200&&(k.success("修改状态成功"),c.value&&c.value.data&&c.value.data.list&&c.value.data.list.length>0&&(c.value.data.list[0].status.statusId=a))})}function ue(){const a=`/api/v1/report/exportOne?reportId=${c.value.id}`,n=$e();Pe({method:"get",baseURL:a,data:{},headers:{Authorization:n?`Bearer ${n}`:void 0},responseType:"blob"}).then(o=>{const p=o.data;if(!p)return;const y=window.URL.createObjectURL(new Blob([p])),w=document.createElement("a");w.style.display="none",w.href=y,w.setAttribute("download","report-"+Re()+".json"),document.body.appendChild(w),w.click(),window.URL.revokeObjectURL(w.href),document.body.removeChild(w)}).catch(o=>{k.error("导出失败,原因:"+o)})}return oe(),(a,n)=>{const o=u("el-card"),p=u("el-tag"),y=u("el-text"),w=u("el-col"),de=u("el-option"),_e=u("el-select"),B=u("el-button"),O=u("el-tooltip"),F=u("el-row"),pe=u("ArrowDownBold"),S=u("el-icon"),me=u("ArrowRightBold"),ve=u("WarningFilled"),J=u("el-empty"),fe=u("el-collapse-item"),he=u("el-collapse"),ge=u("el-tree"),ye=u("el-header"),E=u("el-table-column"),Q=u("el-table"),G=u("el-main"),K=u("el-container"),X=u("el-tab-pane"),ke=u("el-tabs"),Y=u("el-avatar"),be=u("el-input");return l(),d("div",null,[t(o,{shadow:"hover",class:"report-card"},{default:e(()=>{var v,i,D;return[c.value?(l(),d("h3",Ye,[c.value?(l(),d("span",{key:0,class:Ce(R(Ve)(c.value.level)),style:{"margin-right":"10px"}},r(R(De)(c.value.level)),3)):h("",!0),f.value==1||f.value==3?(l(),d("span",Ze,r(c.value.url||((D=(i=(v=c.value.data)==null?void 0:v.list)==null?void 0:i[0])==null?void 0:D.url)||"未知URL"),1)):f.value==2?(l(),d("span",et,r(_.value[0].sourceFile),1)):h("",!0),m(" 发现 "+r(c.value.vulnerableTypeZH),1)])):h("",!0)]}),_:1}),t(o,{class:"report-card",shadow:"hover"},{default:e(()=>[t(F,{gutter:10},{default:e(()=>[t(w,{span:6},{default:e(()=>[c.value?(l(),d("div",tt,[at,c.value.agent?(l(),g(p,{key:0,size:"default",type:"info",effect:"light",class:"ml-2"},{default:e(()=>[m(r(c.value.agent.hostname),1)]),_:1})):(l(),g(y,{key:1,class:"ml-2"},{default:e(()=>[m("未知")]),_:1}))])):h("",!0)]),_:1}),t(w,{span:6},{default:e(()=>[c.value?(l(),d("div",st,[lt,c.value.firstTimestamp?(l(),g(y,{key:0},{default:e(()=>[m(r(c.value.firstTimestamp),1)]),_:1})):h("",!0)])):h("",!0)]),_:1}),t(w,{span:6},{default:e(()=>[c.value?(l(),d("div",nt,[ot,c.value.lastTimestamp?(l(),g(y,{key:0},{default:e(()=>[m(r(c.value.lastTimestamp),1)]),_:1})):h("",!0)])):h("",!0)]),_:1}),t(w,{span:6},{default:e(()=>[t(F,{gutter:10},{default:e(()=>[t(w,{span:8},{default:e(()=>[c.value?(l(),g(_e,{key:0,modelValue:c.value.status.statusId,"onUpdate:modelValue":n[0]||(n[0]=v=>c.value.status.statusId=v),onChange:re},{default:e(()=>[(l(!0),d($,null,P(W.value,v=>(l(),g(de,{label:v.statusName,value:v.statusId,key:v.statusId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):h("",!0)]),_:1}),t(w,{span:6},{default:e(()=>[t(O,{content:"导出漏洞"},{default:e(()=>[t(B,{type:"primary",icon:R(Me),circle:"",onClick:ue},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(o,{class:"report-details",shadow:"hover"},{default:e(()=>[t(ke,{modelValue:U.value,"onUpdate:modelValue":n[1]||(n[1]=v=>U.value=v)},{default:e(()=>[t(X,{label:"漏洞细节",name:"first"},{default:e(()=>[f.value==1?(l(),g(ge,{key:0,indent:16,data:_.value,"node-key":"id",style:{"max-height":"600px","overflow-y":"auto"}},{default:e(({node:v,data:i})=>{var D;return[s("div",ct,[v.level==1?(l(),d("div",it,[s("div",rt,[s("div",ut,[i.name.includes("污染源")?(l(),g(p,{key:0,type:"primary",size:"small",effect:"dark"},{default:e(()=>[t(S,null,{default:e(()=>[t(pe)]),_:1}),m(" 污染源 ")]),_:1})):i.name.includes("传播")?(l(),g(p,{key:1,type:"warning",size:"small",effect:"dark"},{default:e(()=>[t(S,null,{default:e(()=>[t(me)]),_:1}),m(" 传播阶段 ")]),_:1})):i.name.includes("触发")?(l(),g(p,{key:2,type:"danger",size:"small",effect:"dark"},{default:e(()=>[t(S,null,{default:e(()=>[t(ve)]),_:1}),m(" 漏洞触发 ")]),_:1})):h("",!0),s("span",dt,r(i.sign),1)]),s("div",_t,[t(F,{class:"w-600px mb-2"},{default:e(()=>{var x;return[t(O,{content:((x=i.children.find(I=>I.name==="taint"))==null?void 0:x.value)||"",placement:"top-end"},{default:e(()=>[t(y,{class:"taint-highlight",truncated:""},{default:e(()=>{var I;return[m(r(((I=i.children.find(we=>we.name==="taint"))==null?void 0:I.value)||""),1)]}),_:2},1024)]),_:2},1032,["content"]),i.isSanitizer?(l(),d("img",pt)):h("",!0)]}),_:2},1024)])])])):i.name=="stack"&&!((D=v.parent)!=null&&D.data.name.includes("传播"))?(l(),d("div",mt,[s("div",vt,[s("div",ft,[t(S,{class:"stack-icon"},{default:e(()=>[t(R(je))]),_:1}),ht,i.value&&i.value.length>0?(l(),d("span",gt,"("+r(i.value.length)+" 帧)",1)):h("",!0)]),s("div",yt,[i.value&&i.value.length>0?(l(),d("div",kt,[(l(!0),d($,null,P(i.value,(x,I)=>(l(),d("div",{key:I,class:"stack-frame"},[s("div",bt,r(I),1),s("div",wt,[t(O,{content:x,placement:"top",effect:"dark"},{default:e(()=>[s("div",Tt,r(x),1)]),_:2},1032,["content"])])]))),128))])):(l(),d("div",xt,[t(J,{description:"暂无调用栈信息","image-size":60})]))])])])):i.name=="sanitizer"?(l(),d("div",Ct,[t(he,{class:"sanitizer-collapse"},{default:e(()=>[t(fe,{title:"过滤函数",name:"sanitizer"},{default:e(()=>[i.value&&i.value.length>0?(l(!0),d($,{key:0},P(i.value,(x,I)=>(l(),d("div",{key:I},[s("div",It,[s("span",zt,r(I+1)+".",1),t(y,{class:"sanitizer-function"},{default:e(()=>[m(r(R(Xe)(x)),1)]),_:2},1024),t(y,{class:"sanitizer-target"},{default:e(()=>[m(r(x.to),1)]),_:2},1024)])]))),128)):(l(),d("div",Vt,[t(y,{type:"info"},{default:e(()=>[m("暂无过滤函数信息")]),_:1})]))]),_:2},1024)]),_:2},1024)])):(l(),d("div",Dt,[s("div",Rt,[s("div",St,r(i.label),1),s("div",Lt,[t(O,{content:i.value,placement:"top-end"},{default:e(()=>[t(y,{truncated:"",class:"value-text"},{default:e(()=>[m(r(i.value),1)]),_:2},1024)]),_:2},1032,["content"])])])]))])]}),_:1},8,["data"])):f.value==2?(l(),g(K,{key:1},{default:e(()=>[_.value?(l(),g(ye,{key:0},{default:e(()=>[m(" 硬编码漏洞存在于 "),t(y,{tag:"b"},{default:e(()=>[m(r(_.value[0].sourceFile),1)]),_:1}),m(" 文件中, 类路径： "),t(y,{tag:"b"},{default:e(()=>[m(r(_.value[0].className),1)]),_:1})]),_:1})):h("",!0),t(G,null,{default:e(()=>[_.value?(l(),g(Q,{key:0,data:_.value,style:{width:"100%"}},{default:e(()=>[t(E,{prop:"parameterName",label:"参数名"}),t(E,{label:"参数值"},{default:e(v=>[t(y,null,{default:e(()=>[m(r(v.row.parameterValue),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])):h("",!0)]),_:1})]),_:1})):f.value==3?(l(),g(K,{key:2},{default:e(()=>[t(G,null,{default:e(()=>[_.value?(l(),g(Q,{key:0,data:_.value,style:{width:"100%"}},{default:e(()=>[t(E,{prop:"url",label:"数据库连接地址"}),t(E,{prop:"user",label:"用户名"}),t(E,{prop:"password",label:"密码"},{default:e(v=>[t(y,null,{default:e(()=>[m(r(v.row.password),1)]),_:2},1024)]),_:1})]),_:1},8,["data"])):h("",!0)]),_:1})]),_:1})):h("",!0)]),_:1}),f.value==1||f.value==3?(l(),g(X,{key:0,label:"HTTP请求信息",name:"second"},{default:e(()=>[s("div",Ut,[s("div",qt,[s("div",Nt,[At,t(B,{type:"primary",size:"small",onClick:ae},{default:e(()=>[t(S,null,{default:e(()=>[t(R(Z))]),_:1}),m(" 复制 ")]),_:1})]),s("div",Et,[s("pre",Ht,r(T.value),1)])]),s("div",Bt,[s("div",Ot,[$t,t(B,{type:"primary",size:"small",onClick:se},{default:e(()=>[t(S,null,{default:e(()=>[t(R(Z))]),_:1}),m(" 复制 ")]),_:1})]),s("div",Pt,[s("pre",Ft,r(V.value),1)])])])]),_:1})):h("",!0)]),_:1},8,["modelValue"])]),_:1}),c.value?(l(),g(o,{key:0,shadow:"hover",class:"comments-card"},{header:e(()=>[s("div",Wt,[t(S,{class:"header-icon"},{default:e(()=>[t(R(Je))]),_:1}),Mt,s("span",jt,"("+r(q.value.length||0)+")",1)])]),default:e(()=>{var v;return[s("div",Jt,[s("div",Qt,[t(Y,{size:"small",icon:"User",class:"user-avatar"}),s("span",Gt,r((v=H.value)==null?void 0:v.username),1)]),t(be,{modelValue:N.value,"onUpdate:modelValue":n[2]||(n[2]=i=>N.value=i),type:"textarea",rows:2,maxlength:500,resize:"none",placeholder:"添加评论...","show-word-limit":"",class:"comment-textarea"},null,8,["modelValue"]),s("div",Kt,[t(B,{type:"primary",size:"small",onClick:ce,loading:A.value},{default:e(()=>[m(" 添加评论 ")]),_:1},8,["loading"])])]),s("div",Xt,[q.value&&q.value.length>0?(l(),d("div",Yt,[(l(!0),d($,null,P(q.value,i=>{var D;return l(),d("div",{key:i.id,class:"comment-item"},[t(Y,{size:"small",class:"comment-avatar"},{default:e(()=>{var x;return[m(r((((x=i.user)==null?void 0:x.username)||"用户").charAt(0)),1)]}),_:2},1024),s("div",Zt,[s("div",ea,[s("span",ta,r(((D=i.user)==null?void 0:D.username)||"未知用户"),1),s("span",aa,r(i.createdAt),1)]),s("div",sa,r(i.content),1)])])}),128))])):(l(),d("div",la,[t(J,{description:"暂无评论"})]))])]}),_:1})):h("",!0)])}}});const ma=Fe(na,[["__scopeId","data-v-875f9a82"]]);export{ma as default};

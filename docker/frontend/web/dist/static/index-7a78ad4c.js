import{K as G,B as H,M as W,N as X,t as Y,P as Z,Q as ee,E as p,O as te}from"./element-4f7446fd.js";import{a as I,u as ae}from"./index-10ff58db.js";import{g as le}from"./state-8799bcff.js";import{k as oe,_ as ne}from"./index-db029066.js";import{p as se,r as w,ai as s,aq as ie,q as f,t as re,P,M as b,O as a,v as i,U as e,u,S as m,T as g}from"./vue-8cd83afb.js";/* empty css                                                       */import"./vxe-d278ed3b.js";const ce={class:"app-container"},de={class:"toolbar-wrapper"},ue={class:"table-wrapper"},pe=["onClick"],_e={class:"hostname-display"},fe={class:"path-display",style:{"word-break":"break-all",overflow:"hidden","text-overflow":"ellipsis",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical"}},me={class:"version-display"},ge={class:"jdk-display"},ve={class:"state-display"},he={class:"ml-1"},we={class:"demo-pagination-block"},be=se({__name:"index",setup(ye){const c=w(!1),D=w(!1),C=w([]),l=w({pageSize:10,pageNum:1,hostname:"",state:""}),d=async()=>{c.value=!0;try{const o=await I.getAgentsByPage(l.value),{pageSize:n=10,pageNum:_=1,total:v=0,pages:h=0,list:S=[]}=o.data||{};C.value=S,l.value.pageSize=n,l.value.totalPages=h,l.value.pageNum=_,l.value.totalItems=v}catch(o){console.error("获取Agent列表失败:",o),C.value=[],p.warning("获取Agent列表失败，请稍后重试")}finally{c.value=!1}};d();const V=w();async function T(o,n){try{(await ae(o,n)).flag?(p.success("更新成功"),d()):p.warning("更新失败")}catch{p.error("更新失败，请稍后重试")}}function R(){const o=[];for(const n of V.value)o.push(n.agentId);te.confirm("确定删除?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(()=>{p({type:"success",message:"删除成功"}),c.value=!0,Promise.all(o.map(n=>I.deleteAgent(n))).then(()=>{d()}).finally(()=>{c.value=!1})}).catch(()=>{p({type:"info",message:"删除取消"})})}const U=o=>{V.value=o},j=o=>{l.value.pageSize=o,d()},E=o=>{l.value.pageNum=o,d()},M=o=>{};async function $(){const o=l.value.hostname;if(l.value.state==="-1"&&o===""){d();return}c.value=!0;try{d()}catch{p.warning("搜索失败，请稍后重试")}finally{c.value=!1}}const q=()=>{l.value.hostname="",l.value.state="",l.value.pageNum=1,l.value.pageSize=10},K=({row:o})=>o.state===0?"row-disabled":"",O=o=>{oe.push(`/app-detail/${o}`)};return(o,n)=>{const _=s("el-input"),v=s("el-form-item"),h=s("el-option"),S=s("el-select"),y=s("el-button"),F=s("el-form"),N=s("el-card"),A=s("el-tooltip"),r=s("el-table-column"),k=s("el-tag"),z=s("el-icon"),J=s("el-switch"),L=s("el-table"),Q=s("el-pagination"),B=ie("loading");return f(),re("div",ce,[P((f(),b(N,{class:"search-wrapper"},{default:a(()=>[i("div",null,[e(F,{ref:"searchFormRef",inline:!0,model:l.value},{default:a(()=>[e(v,{prop:"hostname",label:"服务器名称"},{default:a(()=>[e(_,{modelValue:l.value.hostname,"onUpdate:modelValue":n[0]||(n[0]=t=>l.value.hostname=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),e(v,{prop:"state",label:"状态"},{default:a(()=>[e(S,{modelValue:l.value.state,"onUpdate:modelValue":n[1]||(n[1]=t=>l.value.state=t),style:{width:"100px"}},{default:a(()=>[e(h,{label:"所有",value:""}),e(h,{label:"在线",value:"1"}),e(h,{label:"离线",value:"0"})]),_:1},8,["modelValue"])]),_:1}),e(v,null,{default:a(()=>[e(y,{type:"primary",icon:u(G),onClick:n[2]||(n[2]=t=>$())},{default:a(()=>[m("查询")]),_:1},8,["icon"]),e(y,{icon:u(H),onClick:q},{default:a(()=>[m("重置")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])])]),_:1})),[[B,c.value]]),P((f(),b(N,null,{default:a(()=>[i("div",de,[i("div",null,[e(y,{type:"danger",icon:u(W),onClick:R},{default:a(()=>[m("批量删除")]),_:1},8,["icon"])]),i("div",null,[e(A,{content:"刷新当前页"},{default:a(()=>[e(y,{type:"primary",icon:u(X),circle:"",onClick:d},null,8,["icon"])]),_:1})])]),i("div",ue,[e(L,{ref:"multipleTableRef",data:C.value,border:"",style:{width:"100%"},"default-sort":{prop:"timestamp",order:"descending"},onSelectionChange:U,onRowClick:M,"row-class-name":K},{default:a(()=>[e(r,{type:"selection",width:"55"}),e(r,{label:"ID",prop:"agentId",width:"320"},{default:a(t=>[i("div",{class:"agent-id-display",style:{cursor:"pointer",color:"#409eff"},onClick:x=>O(t.row.agentId)},g(t.row.agentId),9,pe)]),_:1}),e(r,{width:"240",prop:"hostname",label:"服务器名称",sortable:""},{default:a(t=>[i("div",_e,[e(k,{size:"default",type:"info",effect:"light"},{default:a(()=>[m(g(t.row.hostname),1)]),_:2},1024)])]),_:1}),e(r,{label:"应用路径",prop:"serverPath","min-width":"280"},{default:a(t=>[e(A,{content:t.row.serverPath,placement:"top",effect:"dark"},{default:a(()=>[i("div",fe,g(t.row.serverPath),1)]),_:2},1032,["content"])]),_:1}),e(r,{label:"Agent版本",prop:"version",width:"120"},{default:a(t=>[i("div",me,[e(k,{size:"small",type:"primary",effect:"light"},{default:a(()=>[m(g(t.row.version||"-"),1)]),_:2},1024)])]),_:1}),e(r,{label:"JDK",prop:"jdkVersion",width:"100"},{default:a(t=>[i("div",ge,[e(k,{size:"small",type:"success",effect:"light"},{default:a(()=>[m(g(t.row.jdkVersion||"-"),1)]),_:2},1024)])]),_:1}),e(r,{prop:"state",width:"120",label:"运行状态",align:"center",sortable:""},{default:a(t=>[i("div",ve,[e(k,{size:"small",effect:"light",type:t.row.state===1?"success":t.row.state===0?"danger":"warning"},{default:a(()=>[t.row.state===1?(f(),b(z,{key:0},{default:a(()=>[e(u(Y))]),_:1})):t.row.state===0?(f(),b(z,{key:1},{default:a(()=>[e(u(Z))]),_:1})):(f(),b(z,{key:2},{default:a(()=>[e(u(ee))]),_:1})),i("span",he,g(u(le)(t.row.state)),1)]),_:2},1032,["type"])])]),_:1}),e(r,{prop:"state",width:"120",label:"检测状态",align:"center",sortable:""},{default:a(t=>[e(J,{modelValue:t.row.detectionStatus,"onUpdate:modelValue":x=>t.row.detectionStatus=x,"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949",onClick:x=>T(t.row.agentId,t.row.detectionStatus)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),e(r,{prop:"lastActiveTime",width:"200",label:"最近活跃时间",sortable:""})]),_:1},8,["data"])]),i("div",we,[e(Q,{"current-page":l.value.pageNum,"onUpdate:currentPage":n[3]||(n[3]=t=>l.value.pageNum=t),"page-size":l.value.pageSize,"onUpdate:pageSize":n[4]||(n[4]=t=>l.value.pageSize=t),"page-sizes":[10,20,50,100],small:!1,disabled:D.value,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:l.value.totalItems,onSizeChange:j,onCurrentChange:E},null,8,["current-page","page-size","disabled","total"])])]),_:1})),[[B,c.value]])])}}});const Ae=ne(be,[["__scopeId","data-v-962f0b34"]]);export{Ae as default};
